do local Players=game:GetService("Players");local ReplicatedStorage=game:GetService("ReplicatedStorage");local TextChatService=game:GetService("TextChatService");local UserInputService=game:GetService("UserInputService");local Camera=workspace.CurrentCamera;local RunService=game:GetService("RunService");local TweenService=game:GetService("TweenService");local HttpService=game:GetService("HttpService");local LocalPlayer=Players.LocalPlayer;local player=LocalPlayer;local gui=Instance.new("ScreenGui",player.PlayerGui);gui.Name="ControlPanelGUI";gui.ResetOnSpawn=false;gui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;local DEFAULT_SETTINGS={grabButtonVisible=true,sitButtonVisible=true,autoSitFrameVisible=true,panelVisible=true,dragButtonVisible=true,taserButtonVisible=true,launcherButtonVisible=true,grabButtonPosition=nil,sitButtonPosition=nil,dragButtonPosition=nil,taserButtonPosition=nil,launcherButtonPosition=nil,autoSitFramePosition=nil,grabButtonSize=nil,sitButtonSize=nil,dragButtonSize=nil,taserButtonSize=nil,launcherButtonSize=nil,autoSitFrameSize={64},panelPosition={0,12,0.05,0},blockEnabled=true,targetEnabled=true,blockPlayerIds={},targetPlayerIds={},lastKnownNames={},espEnabled=false};local UserSettings=table.clone(DEFAULT_SETTINGS);local function saveSettings() if pcall(function() return writefile;end) then pcall(function() writefile("userSettings.json",HttpService:JSONEncode(UserSettings));end);end end local function loadSettings() if  not (pcall(function() return isfile;end) and isfile("userSettings.json")) then return;end local ok,data=pcall(function() return HttpService:JSONDecode(readfile("userSettings.json"));end);if (ok and (type(data)=="table")) then for k,v in pairs(data) do UserSettings[k]=v;end end end loadSettings();local blockPlayerIds={};local targetPlayerIds={};local blockPlayerSet={};local targetPlayerSet={};local lastKnownNames={};if (type(UserSettings.blockPlayerIds)=="table") then for _,id in ipairs(UserSettings.blockPlayerIds) do blockPlayerIds[ #blockPlayerIds + 1 ]=id;blockPlayerSet[id]=true;end end if (type(UserSettings.targetPlayerIds)=="table") then for _,id in ipairs(UserSettings.targetPlayerIds) do targetPlayerIds[ #targetPlayerIds + 1 ]=id;targetPlayerSet[id]=true;end end if (type(UserSettings.lastKnownNames)=="table") then for id,n in pairs(UserSettings.lastKnownNames) do lastKnownNames[tonumber(id)]=n;end end local function persistLists() UserSettings.blockPlayerIds=blockPlayerIds;UserSettings.targetPlayerIds=targetPlayerIds;UserSettings.lastKnownNames=lastKnownNames;saveSettings();end local function tableToUDim2(t,fallback) if ((type(t)=="table") and ( #t==4)) then return UDim2.new(t[1],t[2],t[3],t[4]);end return fallback;end local function udim2ToTable(ud) return {ud.X.Scale,ud.X.Offset,ud.Y.Scale,ud.Y.Offset};end local THEME={bg=Color3.fromRGB(18,30,35),panelAccent=Color3.fromRGB(28,40,48),soft=Color3.fromRGB(45,50,56),accent=Color3.fromRGB(0,150,136),text=Color3.fromRGB(230,230,230),success=Color3.fromRGB(40,200,100),muted=Color3.fromRGB(130,130,130),error=Color3.fromRGB(180,60,60)};local colorMap={Grab=Color3.fromRGB(66,135,245),Drag=Color3.fromRGB(50,205,50),Taser=Color3.fromRGB(255,215,0),["Launcher Grenade"]=Color3.fromRGB(220,20,60),Sit=Color3.fromRGB(255,255,255),["Auto Sit"]=Color3.fromRGB(255,165,0)};local customMode=false;local currentDragConnections={};local currentDragTarget=nil;local defaultConfig={};local toolButtons={};local isConfigMenuOpen=false;local buttonSnapshots={};local currentTool="Grab";local toolOrder={"Leafblower","Arm Rocket","Fishing Rod","Snowglobe","Grab","Drag","Taser","Mind Control","Grenade Launcher"};local lastActionTime=0;local function EquipTool(targetTool) if (currentTool==targetTool) then return;end local currentIndex,targetIndex=1,1;for i,tool in ipairs(toolOrder) do if (tool==currentTool) then currentIndex=i;end if (tool==targetTool) then targetIndex=i;end end local forwardSteps=((targetIndex>currentIndex) and (targetIndex-currentIndex)) or (( #toolOrder-currentIndex) + targetIndex) ;local backwardSteps=((currentIndex>targetIndex) and (currentIndex-targetIndex)) or (( #toolOrder-targetIndex) + currentIndex) ;local stepDirection=((forwardSteps<=backwardSteps) and 1) or  -1 ;local i=currentIndex;while i~=targetIndex  do i=i + stepDirection ;if (i> #toolOrder) then i=1;end if (i<1) then i= #toolOrder;end local args={[1]=toolOrder[i]};if (ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("EquipTool")) then ReplicatedStorage.Events.EquipTool:FireServer(unpack(args));end if ((toolOrder[i]=="Taser") or (toolOrder[i]=="Grab") or (toolOrder[i]=="Drag")) then wait(0.05);else wait(0.15);end end currentTool=targetTool;lastActionTime=os.clock();end local function cleanupCurrentDrag() for _,c in ipairs(currentDragConnections) do pcall(function() c:Disconnect();end);end currentDragConnections={};currentDragTarget=nil;end local function makeDraggable(frame,dragHandle) dragHandle=dragHandle or frame ;local dragging,dragStart,startPos;dragHandle.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then dragging=true;dragStart=input.Position;startPos=frame.Position;input.Changed:Connect(function() if (input.UserInputState==Enum.UserInputState.End) then dragging=false;local ti=TweenInfo.new(0.12,Enum.EasingStyle.Quad,Enum.EasingDirection.Out);pcall(function() TweenService:Create(frame,ti,{Position=frame.Position}):Play();end);end end);end end);dragHandle.InputChanged:Connect(function(input) if  not dragging then return;end if ((input.UserInputType~=Enum.UserInputType.MouseMovement) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end local delta=input.Position-dragStart ;frame.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset + delta.X ,startPos.Y.Scale,startPos.Y.Offset + delta.Y );end);end local function sendMessage(msg) if ( not msg or (msg=="")) then return;end local ok,channel=pcall(function() return TextChatService:FindFirstChild("TextChannels") and TextChatService.TextChannels:FindFirstChild("RBXGeneral") ;end);if (ok and channel) then pcall(function() channel:SendAsync(msg);end);end end local function GetClosestPlayer() local closestPlayer=nil;local closestDistance=math.huge;local localCharacter=LocalPlayer.Character;if ( not localCharacter or  not localCharacter:FindFirstChild("HumanoidRootPart")) then return nil;end local localPosition=localCharacter.HumanoidRootPart.Position;for _,p in pairs(Players:GetPlayers()) do if (p~=LocalPlayer) then local character=p.Character;if (character and character:FindFirstChild("HumanoidRootPart")) then local distance=(character.HumanoidRootPart.Position-localPosition).Magnitude;if (distance<closestDistance) then closestDistance=distance;closestPlayer=p;end end end end return closestPlayer;end local function GetPlayerLookingAt() local camera=workspace.CurrentCamera;local mouse=LocalPlayer:GetMouse();local ray=camera:ScreenPointToRay(mouse.X,mouse.Y);local direction=ray.Direction * 1000 ;local raycastResult=workspace:Raycast(ray.Origin,direction);if (raycastResult and raycastResult.Instance) then local hitPart=raycastResult.Instance;for _,p in pairs(Players:GetPlayers()) do if ((p~=LocalPlayer) and p.Character and p.Character:IsAncestorOf(hitPart)) then return p;end end end local cameraDirection=camera.CFrame.LookVector;local cameraPosition=camera.CFrame.Position;local closestPlayer,closestAngle=nil,math.rad(30);for _,p in pairs(Players:GetPlayers()) do if ((p~=LocalPlayer) and p.Character and p.Character:FindFirstChild("HumanoidRootPart")) then local playerPosition=p.Character.HumanoidRootPart.Position;local directionToPlayer=(playerPosition-cameraPosition).Unit;local angle=math.acos(cameraDirection:Dot(directionToPlayer));if (angle<closestAngle) then closestAngle=angle;closestPlayer=p;end end end return closestPlayer;end local function ExecuteAction(actionType,targetPart,targetPosition,targetCFrame) if (ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("Grab")) then local args={[1]=targetPart,[2]=actionType,[3]=targetPosition,[4]=targetCFrame};ReplicatedStorage.Events.Grab:FireServer(unpack(args));end end local function highlightPlayer(playerCharacter) if playerCharacter then local highlight=Instance.new("Highlight");highlight.FillColor=Color3.new(1,0,0);highlight.OutlineColor=Color3.new(0,0,0);highlight.Parent=playerCharacter;spawn(function() wait(0.1);pcall(function() highlight:Destroy();end);end);end end local function splitWords(s) local t={};for w in string.gmatch(s or "" ,"[%w]+") do table.insert(t,w);end return t;end local function buildInitials(s) local words=splitWords(s);local initials="";for _,w in ipairs(words) do initials=initials   .. (string.sub(w,1,1) or "") ;end return initials:lower();end local function matchNameInput(input,p) if ( not input or (input=="") or  not p) then return false;end local inputLower=tostring(input):lower();local nameLower=tostring(p.Name or "" ):lower();local displayLower=tostring(p.DisplayName or "" ):lower();if (string.find(nameLower,inputLower,1,true) or string.find(displayLower,inputLower,1,true)) then return true;end for _,token in ipairs(splitWords(nameLower)) do if (string.sub(token,1, #inputLower)==inputLower) then return true;end end for _,token in ipairs(splitWords(displayLower)) do if (string.sub(token,1, #inputLower)==inputLower) then return true;end end local nameInit=buildInitials(nameLower);local dispInit=buildInitials(displayLower);if ((inputLower==nameInit) or (inputLower==dispInit)) then return true;end return false;end local btnSizeDefault=64;local buttonSpacing=70;local rightMargin=20;local buttonStartY=50;local function createSquareButton(name,position,size,text,textColor) local btnSizeDefaultLocal=size or 64 ;local button=Instance.new("TextButton");button.Name=name;if (typeof(position)=="UDim2") then button.Position=position;else button.Position=UDim2.new(0,0,0,0);end button.Size=UDim2.new(0,btnSizeDefaultLocal,0,btnSizeDefaultLocal);button.BackgroundColor3=THEME.soft;button.TextColor3=textColor or THEME.text ;button.Font=Enum.Font.GothamBold;button.TextSize=14;button.TextWrapped=true;button.Text=text or "" ;button.AutoButtonColor=false;button.Active=true;button.Draggable=false;button.ZIndex=5;button.Parent=gui;Instance.new("UICorner",button).CornerRadius=UDim.new(0,10);local stroke=Instance.new("UIStroke",button);stroke.Color=Color3.fromRGB(20,20,20);stroke.Transparency=0.6;stroke.Thickness=1;defaultConfig[name]={Position=button.Position,Size=button.Size,Visible=true};toolButtons[name]=button;return button;end local grabButton=createSquareButton("GrabButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY),btnSizeDefault,"GRAB",colorMap['Grab']);local dragButton=createSquareButton("DragButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + buttonSpacing ),btnSizeDefault,"DRAG",colorMap['Drag']);local taserButton=createSquareButton("TaserButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 2) ),btnSizeDefault,"TASER",colorMap['Taser']);local launcherButton=createSquareButton("LauncherButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 3) ),btnSizeDefault,"GRENADE",colorMap["Launcher Grenade"]);local leftOffset=(btnSizeDefault * 2) + rightMargin + 40 ;local sitButton=createSquareButton("SitButton",UDim2.new(1, -leftOffset,0,buttonStartY),btnSizeDefault,"SIT",colorMap['Sit']);local autoSitFrame=Instance.new("Frame",gui);autoSitFrame.Name="AutoSitFrame";autoSitFrame.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);autoSitFrame.Position=UDim2.new(1, -leftOffset,0,buttonStartY + buttonSpacing );autoSitFrame.BackgroundColor3=THEME.soft;autoSitFrame.BackgroundTransparency=0.12;autoSitFrame.Active=true;autoSitFrame.Selectable=true;autoSitFrame.ZIndex=5;Instance.new("UICorner",autoSitFrame).CornerRadius=UDim.new(0,10);local stroke=Instance.new("UIStroke",autoSitFrame);stroke.Color=Color3.fromRGB(20,20,20);stroke.Transparency=0.6;stroke.Thickness=1;local manualButton=Instance.new("TextButton",autoSitFrame);manualButton.Name="ManualButton";manualButton.Size=UDim2.new(0.5,0,1,0);manualButton.Position=UDim2.new(0,0,0,0);manualButton.BackgroundTransparency=0;manualButton.BackgroundColor3=THEME.soft;manualButton.Text="MANUAL";manualButton.TextColor3=THEME.text;manualButton.Font=Enum.Font.GothamBold;manualButton.TextSize=12;manualButton.AutoButtonColor=false;manualButton.ZIndex=6;local autoButton=Instance.new("TextButton",autoSitFrame);autoButton.Name="AutoButton";autoButton.Size=UDim2.new(0.5,0,1,0);autoButton.Position=UDim2.new(0.5,0,0,0);autoButton.BackgroundTransparency=0;autoButton.BackgroundColor3=THEME.soft;autoButton.Text="AUTO";autoButton.TextColor3=THEME.text;autoButton.Font=Enum.Font.GothamBold;autoButton.TextSize=12;autoButton.AutoButtonColor=false;autoButton.ZIndex=6;local divider=Instance.new("Frame",autoSitFrame);divider.Size=UDim2.new(0,1,0.8,0);divider.Position=UDim2.new(0.5,0,0.1,0);divider.BackgroundColor3=Color3.new(0.5,0.5,0.5);divider.ZIndex=5;local autoSitEnabled=false;local HoldingManual=false;local Busy=false;local lastAutoSitTime=0;local autoSitRateLimit=1;local function IsInAbnormalState() local character=LocalPlayer.Character;if  not character then return false;end local humanoid=character:FindFirstChildOfClass("Humanoid");local rootPart=character:FindFirstChild("HumanoidRootPart");if ( not humanoid or  not rootPart) then return false;end if humanoid.PlatformStand then return true;end local AngleX=math.abs(rootPart.Orientation.X);local AngleZ=math.abs(rootPart.Orientation.Z);if ((AngleX>70) or (AngleZ>70)) then return true;end return false;end local function isAlive() local char=LocalPlayer.Character;if  not char then return false;end local humanoid=char:FindFirstChildOfClass("Humanoid");if  not humanoid then return false;end if (humanoid.Health<=0) then return false;end if (humanoid:GetState()==Enum.HumanoidStateType.Dead) then return false;end return true;end local function SendSitCommand() sendMessage("/sit");end local function ExecuteAutoSit() if (Busy or  not isAlive()) then return;end Busy=true;SendSitCommand();local humanoid=LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") ;if humanoid then local startTime=tick();while  not humanoid.Sit and ((tick() -startTime)<0.6)  do wait();if humanoid.Sit then break;end end if humanoid.Sit then wait(math.random(120,180)/1000 );humanoid.Sit=false;wait(math.random(120,180)/1000 );humanoid.Jump=true;end end Busy=false;end local function AutoCheckImproved() if  not autoSitEnabled then return;end if  not isAlive() then return;end if HoldingManual then return;end if IsInAbnormalState() then local now=tick();if ((now-lastAutoSitTime)<autoSitRateLimit) then return;end lastAutoSitTime=now;local humanoid=LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") ;if (humanoid and (humanoid.Health>0)) then if (humanoid:GetState()~=Enum.HumanoidStateType.Seated) then pcall(function() humanoid:ChangeState(Enum.HumanoidStateType.Seated);end);end end end end local openConfigMenu=function(targetBtn) end;local panelToggle=createSquareButton("PanelToggle",UDim2.new(0,20,1, -84),48,"≡",THEME.text);local panel=Instance.new("Frame",gui);panel.Name="Panel";panel.Size=UDim2.new(0,700,0,380);if (UserSettings.panelPosition and ( #UserSettings.panelPosition==4)) then panel.Position=tableToUDim2(UserSettings.panelPosition,UDim2.new(DEFAULT_SETTINGS.panelPosition[1],DEFAULT_SETTINGS.panelPosition[2],DEFAULT_SETTINGS.panelPosition[3],DEFAULT_SETTINGS.panelPosition[4]));else panel.Position=UDim2.new(DEFAULT_SETTINGS.panelPosition[1],DEFAULT_SETTINGS.panelPosition[2],DEFAULT_SETTINGS.panelPosition[3],DEFAULT_SETTINGS.panelPosition[4]);end panel.BackgroundColor3=THEME.bg;panel.BorderSizePixel=0;panel.Visible=((UserSettings.panelVisible==nil) and DEFAULT_SETTINGS.panelVisible) or UserSettings.panelVisible ;panel.ZIndex=10;Instance.new("UICorner",panel).CornerRadius=UDim.new(0,12);local panelTitleBar=Instance.new("Frame",panel);panelTitleBar.Size=UDim2.new(1,0,0,36);panelTitleBar.BackgroundTransparency=1;panelTitleBar.ZIndex=11;local panelTitle=Instance.new("TextLabel",panelTitleBar);panelTitle.Size=UDim2.new(1, -12,1,0);panelTitle.Position=UDim2.new(0,12,0,0);panelTitle.BackgroundTransparency=1;panelTitle.Text="Nex hub";panelTitle.Font=Enum.Font.SourceSansBold;panelTitle.TextSize=18;panelTitle.TextColor3=THEME.text;panelTitle.TextXAlignment=Enum.TextXAlignment.Left;panelTitle.ZIndex=11;makeDraggable(panel,panelTitleBar);local tabsBar=Instance.new("Frame",panel);tabsBar.Size=UDim2.new(1, -24,0,32);tabsBar.Position=UDim2.new(0,12,0,44);tabsBar.BackgroundTransparency=1;tabsBar.ZIndex=11;local mainTabBtn=Instance.new("TextButton",tabsBar);mainTabBtn.Size=UDim2.new(0.5, -6,1,0);mainTabBtn.Position=UDim2.new(0,0,0,0);mainTabBtn.Text="Main";mainTabBtn.Font=Enum.Font.SourceSansBold;mainTabBtn.TextSize=14;mainTabBtn.BackgroundColor3=THEME.accent;mainTabBtn.TextColor3=THEME.text;Instance.new("UICorner",mainTabBtn).CornerRadius=UDim.new(0,8);mainTabBtn.ZIndex=12;local targetTabBtn=Instance.new("TextButton",tabsBar);targetTabBtn.Size=UDim2.new(0.5, -6,1,0);targetTabBtn.Position=UDim2.new(0.5,12,0,0);targetTabBtn.Text="Target";targetTabBtn.Font=Enum.Font.SourceSansBold;targetTabBtn.TextSize=14;targetTabBtn.BackgroundColor3=Color3.fromRGB(50,50,50);targetTabBtn.TextColor3=THEME.text;Instance.new("UICorner",targetTabBtn).CornerRadius=UDim.new(0,8);targetTabBtn.ZIndex=12;local mainContent=Instance.new("Frame",panel);mainContent.Size=UDim2.new(1, -24,1, -140);mainContent.Position=UDim2.new(0,12,0,84);mainContent.BackgroundTransparency=1;mainContent.ZIndex=11;local targetContent=Instance.new("Frame",panel);targetContent.Size=mainContent.Size;targetContent.Position=mainContent.Position;targetContent.BackgroundTransparency=1;targetContent.ZIndex=11;targetContent.Visible=false;local customRow=Instance.new("Frame",mainContent);customRow.Size=UDim2.new(1,0,0,36);customRow.Position=UDim2.new(0,0,0,4);customRow.BackgroundTransparency=1;customRow.ZIndex=11;local customLabel=Instance.new("TextLabel",customRow);customLabel.Size=UDim2.new(0.5,0,1,0);customLabel.Position=UDim2.new(0,8,0,0);customLabel.BackgroundTransparency=1;customLabel.Text="Custom Edit";customLabel.Font=Enum.Font.SourceSans;customLabel.TextSize=14;customLabel.TextColor3=THEME.text;customLabel.TextXAlignment=Enum.TextXAlignment.Left;customLabel.ZIndex=11;local toggleBg=Instance.new("Frame",customRow);toggleBg.Size=UDim2.new(0,60,0,28);toggleBg.Position=UDim2.new(1, -72,0,4);toggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);toggleBg.ZIndex=11;local toggleKnob=Instance.new("Frame",toggleBg);toggleKnob.Size=UDim2.new(0,24,0,24);toggleKnob.Position=UDim2.new(0,2,0,2);toggleKnob.BackgroundColor3=Color3.fromRGB(235,235,235);Instance.new("UICorner",toggleBg).CornerRadius=UDim.new(0,12);Instance.new("UICorner",toggleKnob).CornerRadius=UDim.new(1,0);toggleBg.ZIndex=11;toggleKnob.ZIndex=12;local function setToggleState(on) customMode=on;if on then toggleBg.BackgroundColor3=THEME.accent;toggleKnob.Position=UDim2.new(1, -26,0,2);toggleKnob.BackgroundColor3=Color3.fromRGB(18,18,18);else toggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);toggleKnob.Position=UDim2.new(0,2,0,2);toggleKnob.BackgroundColor3=Color3.fromRGB(235,235,235);cleanupCurrentDrag();local existing=gui:FindFirstChild("ConfigMenu");if existing then existing:Destroy();end isConfigMenuOpen=false;end end setToggleState(false);toggleBg.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then setToggleState( not customMode);end end);local scroll=Instance.new("ScrollingFrame",mainContent);scroll.Size=UDim2.new(1, -12,0,200);scroll.Position=UDim2.new(0,6,0,44);scroll.BackgroundTransparency=1;scroll.ScrollBarThickness=6;scroll.ScrollBarImageColor3=THEME.soft;scroll.ZIndex=11;local panelButtonsList={{name="Grab",button=grabButton},{name="Sit",button=sitButton},{name="Drag",button=dragButton},{name="Taser",button=taserButton},{name="Launcher Grenade",button=launcherButton},{name="Auto Sit",button=autoSitFrame}};local rowHeight=44;for i,btnInfo in ipairs(panelButtonsList) do local y=(i-1) * rowHeight ;local row=Instance.new("Frame",scroll);row.Size=UDim2.new(1, -12,0,rowHeight-6 );row.Position=UDim2.new(0,6,0,y + 2 );row.BackgroundTransparency=1;row.ZIndex=11;local lbl=Instance.new("TextLabel",row);lbl.Size=UDim2.new(0.6,0,1,0);lbl.Position=UDim2.new(0,0,0,0);lbl.BackgroundTransparency=1;lbl.Font=Enum.Font.SourceSans;lbl.TextSize=14;lbl.TextXAlignment=Enum.TextXAlignment.Left;lbl.Text=btnInfo.name;lbl.TextColor3=THEME.text;lbl.ZIndex=11;local visBg=Instance.new("Frame",row);visBg.Size=UDim2.new(0,92,0,26);visBg.Position=UDim2.new(1, -100,0,6);visBg.BackgroundColor3=Color3.fromRGB(50,50,50);Instance.new("UICorner",visBg).CornerRadius=UDim.new(0,8);visBg.ZIndex=11;local visLabel=Instance.new("TextLabel",visBg);visLabel.Size=UDim2.new(1, -36,1,0);visLabel.Position=UDim2.new(0,8,0,0);visLabel.BackgroundTransparency=1;visLabel.Font=Enum.Font.SourceSansBold;visLabel.TextSize=13;visLabel.TextColor3=THEME.text;visLabel.ZIndex=12;local visBtn=Instance.new("TextButton",visBg);visBtn.Size=UDim2.new(0,28,0,24);visBtn.Position=UDim2.new(1, -32,0,1);visBtn.Text="";visBtn.AutoButtonColor=false;Instance.new("UICorner",visBtn).CornerRadius=UDim.new(0,6);visBtn.ZIndex=12;local function updateVisibilityState() if (btnInfo.button and btnInfo.button.Visible) then visLabel.Text="Visible";visBg.BackgroundColor3=THEME.success;visBtn.BackgroundColor3=Color3.fromRGB(18,18,18);else visLabel.Text="Hidden";visBg.BackgroundColor3=THEME.soft;visBtn.BackgroundColor3=Color3.fromRGB(200,200,200);end end updateVisibilityState();visBtn.MouseButton1Click:Connect(function() if  not btnInfo.button then return;end btnInfo.button.Visible= not btnInfo.button.Visible;if (btnInfo.name=="Grab") then UserSettings.grabButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Sit") then UserSettings.sitButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Auto Sit") then UserSettings.autoSitFrameVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Drag") then UserSettings.dragButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Taser") then UserSettings.taserButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Launcher Grenade") then UserSettings.launcherButtonVisible=btnInfo.button.Visible;end updateVisibilityState();saveSettings();end);end scroll.CanvasSize=UDim2.new(0,0,0,( #panelButtonsList * rowHeight) + 8 );local resetBtn=Instance.new("TextButton",panel);resetBtn.Size=UDim2.new(0,120,0,28);resetBtn.Position=UDim2.new(0,12,1, -44);resetBtn.BackgroundColor3=Color3.fromRGB(80,40,40);resetBtn.TextColor3=THEME.text;resetBtn.Font=Enum.Font.SourceSansBold;resetBtn.TextSize=14;resetBtn.Text="Reset Config";Instance.new("UICorner",resetBtn).CornerRadius=UDim.new(0,8);resetBtn.ZIndex=11;resetBtn.MouseButton1Click:Connect(function() cleanupCurrentDrag();for name,btn in pairs(toolButtons) do local def=defaultConfig[name];if (def and btn) then pcall(function() btn.Position=def.Position;btn.Size=def.Size;btn.Visible=def.Visible;end);end end panel.Position=UDim2.new(0,12,0.05,0);UserSettings=table.clone(DEFAULT_SETTINGS);blockPlayerIds={};targetPlayerIds={};blockPlayerSet={};targetPlayerSet={};lastKnownNames={};persistLists();saveSettings();end);panelToggle.MouseButton1Click:Connect(function() panel.Visible= not panel.Visible;panelToggle.Text=(panel.Visible and "✕") or "≡" ;UserSettings.panelVisible=panel.Visible;saveSettings();end);grabButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=grabButton.Position;if (pos and pos.X and pos.Y) then UserSettings.grabButtonPosition=udim2ToTable(pos);saveSettings();end end);sitButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=sitButton.Position;if (pos and pos.X and pos.Y) then UserSettings.sitButtonPosition=udim2ToTable(pos);saveSettings();end end);dragButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=dragButton.Position;if (pos and pos.X and pos.Y) then UserSettings.dragButtonPosition=udim2ToTable(pos);saveSettings();end end);taserButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=taserButton.Position;if (pos and pos.X and pos.Y) then UserSettings.taserButtonPosition=udim2ToTable(pos);saveSettings();end end);launcherButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=launcherButton.Position;if (pos and pos.X and pos.Y) then UserSettings.launcherButtonPosition=udim2ToTable(pos);saveSettings();end end);panel:GetPropertyChangedSignal("Position"):Connect(function() local pos=panel.Position;UserSettings.panelPosition=udim2ToTable(pos);saveSettings();end);manualButton.InputBegan:Connect(function(input) if ((input.UserInputType~=Enum.UserInputType.MouseButton1) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end if customMode then pcall(function() openConfigMenu(autoSitFrame);end);return;end HoldingManual=true;manualButton.BackgroundColor3=THEME.success;manualButton.TextColor3=THEME.text;spawn(function() while HoldingManual do if ( not Busy and HoldingManual) then ExecuteAutoSit();end wait(0.12);end end);end);manualButton.InputEnded:Connect(function(input) if ((input.UserInputType~=Enum.UserInputType.MouseButton1) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end if customMode then return;end HoldingManual=false;manualButton.BackgroundColor3=THEME.soft;manualButton.TextColor3=THEME.text;end);manualButton.MouseLeave:Connect(function() if HoldingManual then HoldingManual=false;manualButton.BackgroundColor3=THEME.soft;manualButton.TextColor3=THEME.text;end end);autoButton.InputBegan:Connect(function(input) if ((input.UserInputType~=Enum.UserInputType.MouseButton1) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end if customMode then pcall(function() openConfigMenu(autoSitFrame);end);return;end autoSitEnabled= not autoSitEnabled;if autoSitEnabled then autoButton.BackgroundColor3=THEME.success;autoButton.TextColor3=THEME.text;manualButton.BackgroundColor3=THEME.soft;manualButton.TextColor3=THEME.text;else autoButton.BackgroundColor3=THEME.soft;autoButton.TextColor3=THEME.text;manualButton.BackgroundColor3=THEME.soft;manualButton.TextColor3=THEME.text;end end);autoSitFrame.InputBegan:Connect(function(input) if (((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) and customMode) then pcall(function() openConfigMenu(autoSitFrame);end);end end);RunService.Heartbeat:Connect(function() pcall(AutoCheckImproved);end);mainTabBtn.MouseButton1Click:Connect(function() mainTabBtn.BackgroundColor3=THEME.accent;targetTabBtn.BackgroundColor3=Color3.fromRGB(50,50,50);mainContent.Visible=true;targetContent.Visible=false;end);targetTabBtn.MouseButton1Click:Connect(function() mainTabBtn.BackgroundColor3=Color3.fromRGB(50,50,50);targetTabBtn.BackgroundColor3=THEME.accent;mainContent.Visible=false;targetContent.Visible=true;end);panelToggle.Text=(panel.Visible and "✕") or "≡" ;player.CharacterAdded:Connect(function(char) char:WaitForChild("Humanoid");HoldingManual=false;autoSitEnabled=false;autoButton.BackgroundColor3=THEME.soft;autoButton.TextColor3=THEME.text;end);local blockColumn=Instance.new("Frame",targetContent);blockColumn.Size=UDim2.new(0.5, -12,1, -46);blockColumn.Position=UDim2.new(0,6,0,46);blockColumn.BackgroundTransparency=1;blockColumn.ZIndex=11;local targetColumn=Instance.new("Frame",targetContent);targetColumn.Size=UDim2.new(0.5, -12,1, -46);targetColumn.Position=UDim2.new(0.5,12,0,46);targetColumn.BackgroundTransparency=1;targetColumn.ZIndex=11;local blockTitleRow=Instance.new("Frame",blockColumn);blockTitleRow.Size=UDim2.new(1,0,0,28);blockTitleRow.Position=UDim2.new(0,0,0,0);blockTitleRow.BackgroundTransparency=1;local blockTitle=Instance.new("TextLabel",blockTitleRow);blockTitle.Size=UDim2.new(0.65,0,1,0);blockTitle.BackgroundTransparency=1;blockTitle.Font=Enum.Font.SourceSansBold;blockTitle.TextSize=14;blockTitle.TextColor3=THEME.text;blockTitle.Text="Block Player (exclude these tools)";blockTitle.TextXAlignment=Enum.TextXAlignment.Left;local blockToggle=Instance.new("TextButton",blockTitleRow);blockToggle.Size=UDim2.new(0.33,0,0.9,0);blockToggle.Position=UDim2.new(0.66,0,0.05,0);blockToggle.Font=Enum.Font.SourceSansBold;blockToggle.TextSize=13;blockToggle.TextColor3=THEME.text;Instance.new("UICorner",blockToggle).CornerRadius=UDim.new(0,6);blockToggle.ZIndex=21;local function refreshBlockToggleVisual() if UserSettings.blockEnabled then blockToggle.Text="Block: ON";blockToggle.BackgroundColor3=THEME.success;else blockToggle.Text="Block: OFF";blockToggle.BackgroundColor3=THEME.muted;end end if (type(UserSettings.blockEnabled)~="boolean") then UserSettings.blockEnabled=true;end refreshBlockToggleVisual();local blockInputRow=Instance.new("Frame",blockColumn);blockInputRow.Size=UDim2.new(1,0,0,32);blockInputRow.Position=UDim2.new(0,0,0,36);blockInputRow.BackgroundTransparency=1;local blockTextBox=Instance.new("TextBox",blockInputRow);blockTextBox.Size=UDim2.new(0.7,0,1,0);blockTextBox.Position=UDim2.new(0,0,0,0);blockTextBox.Text="";blockTextBox.PlaceholderText="";blockTextBox.ClearTextOnFocus=false;blockTextBox.Font=Enum.Font.SourceSans;blockTextBox.TextSize=14;blockTextBox.TextColor3=THEME.text;blockTextBox.BackgroundColor3=Color3.fromRGB(40,40,40);Instance.new("UICorner",blockTextBox).CornerRadius=UDim.new(0,6);blockTextBox.ZIndex=21;local blockAddBtn=Instance.new("TextButton",blockInputRow);blockAddBtn.Size=UDim2.new(0.28,0,1,0);blockAddBtn.Position=UDim2.new(0.72,8,0,0);blockAddBtn.Text="Add";blockAddBtn.Font=Enum.Font.SourceSansBold;blockAddBtn.TextSize=14;blockAddBtn.TextColor3=THEME.text;blockAddBtn.BackgroundColor3=THEME.accent;Instance.new("UICorner",blockAddBtn).CornerRadius=UDim.new(0,6);blockAddBtn.ZIndex=21;local blockListFrameBg=Instance.new("Frame",blockColumn);blockListFrameBg.Size=UDim2.new(1,0,0,140);blockListFrameBg.Position=UDim2.new(0,0,0,72);blockListFrameBg.BackgroundColor3=Color3.fromRGB(28,32,36);Instance.new("UICorner",blockListFrameBg).CornerRadius=UDim.new(0,8);blockListFrameBg.ZIndex=19;local blockListFrame=Instance.new("ScrollingFrame",blockListFrameBg);blockListFrame.Size=UDim2.new(1, -12,1, -12);blockListFrame.Position=UDim2.new(0,6,0,6);blockListFrame.BackgroundTransparency=1;blockListFrame.ScrollBarThickness=6;blockListFrame.ZIndex=20;blockListFrame.CanvasSize=UDim2.new(0,0,0,0);local targetTitleRow=Instance.new("Frame",targetColumn);targetTitleRow.Size=UDim2.new(1,0,0,28);targetTitleRow.Position=UDim2.new(0,0,0,0);targetTitleRow.BackgroundTransparency=1;local targetTitle=Instance.new("TextLabel",targetTitleRow);targetTitle.Size=UDim2.new(0.65,0,1,0);targetTitle.BackgroundTransparency=1;targetTitle.Font=Enum.Font.SourceSansBold;targetTitle.TextSize=14;targetTitle.TextColor3=THEME.text;targetTitle.Text="Target Player (only affect these)";targetTitle.TextXAlignment=Enum.TextXAlignment.Left;local targetToggle=Instance.new("TextButton",targetTitleRow);targetToggle.Size=UDim2.new(0.33,0,0.9,0);targetToggle.Position=UDim2.new(0.66,0,0.05,0);targetToggle.Font=Enum.Font.SourceSansBold;targetToggle.TextSize=13;targetToggle.TextColor3=THEME.text;Instance.new("UICorner",targetToggle).CornerRadius=UDim.new(0,6);targetToggle.ZIndex=21;local function refreshTargetToggleVisual() if UserSettings.targetEnabled then targetToggle.Text="Target: ON";targetToggle.BackgroundColor3=THEME.success;else targetToggle.Text="Target: OFF";targetToggle.BackgroundColor3=THEME.muted;end end if (type(UserSettings.targetEnabled)~="boolean") then UserSettings.targetEnabled=true;end refreshTargetToggleVisual();local targetInputRow=Instance.new("Frame",targetColumn);targetInputRow.Size=UDim2.new(1,0,0,32);targetInputRow.Position=UDim2.new(0,0,0,36);targetInputRow.BackgroundTransparency=1;local targetTextBox=Instance.new("TextBox",targetInputRow);targetTextBox.Size=UDim2.new(0.7,0,1,0);targetTextBox.Position=UDim2.new(0,0,0,0);targetTextBox.Text="";targetTextBox.PlaceholderText="";targetTextBox.ClearTextOnFocus=false;targetTextBox.Font=Enum.Font.SourceSans;targetTextBox.TextSize=14;targetTextBox.TextColor3=THEME.text;targetTextBox.BackgroundColor3=Color3.fromRGB(40,40,40);Instance.new("UICorner",targetTextBox).CornerRadius=UDim.new(0,6);targetTextBox.ZIndex=21;local targetAddBtn=Instance.new("TextButton",targetInputRow);targetAddBtn.Size=UDim2.new(0.28,0,1,0);targetAddBtn.Position=UDim2.new(0.72,8,0,0);targetAddBtn.Text="Add";targetAddBtn.Font=Enum.Font.SourceSansBold;targetAddBtn.TextSize=14;targetAddBtn.TextColor3=THEME.text;targetAddBtn.BackgroundColor3=THEME.accent;Instance.new("UICorner",targetAddBtn).CornerRadius=UDim.new(0,6);targetAddBtn.ZIndex=21;local targetListFrameBg=Instance.new("Frame",targetColumn);targetListFrameBg.Size=UDim2.new(1,0,0,140);targetListFrameBg.Position=UDim2.new(0,0,0,72);targetListFrameBg.BackgroundColor3=Color3.fromRGB(28,32,36);Instance.new("UICorner",targetListFrameBg).CornerRadius=UDim.new(0,8);targetListFrameBg.ZIndex=19;local targetListFrame=Instance.new("ScrollingFrame",targetListFrameBg);targetListFrame.Size=UDim2.new(1, -12,1, -12);targetListFrame.Position=UDim2.new(0,6,0,6);targetListFrame.BackgroundTransparency=1;targetListFrame.ScrollBarThickness=6;targetListFrame.ZIndex=20;targetListFrame.CanvasSize=UDim2.new(0,0,0,0);local uiEntries={};local function getDisplayForId(id,p) if p then if (p.DisplayName and (p.DisplayName~="") and (p.DisplayName~=p.Name)) then return tostring(p.DisplayName);else return tostring(p.Name);end else if lastKnownNames[id] then return lastKnownNames[id];end return "UserId:"   .. tostring(id) ;end end local esps={};local function createBillboardForCharacter(character,text,color) if  not character then return nil;end local head=character:FindFirstChild("Head") or character:FindFirstChild("HumanoidRootPart") ;if  not head then return nil;end for _,child in ipairs(head:GetChildren()) do if (child:IsA("BillboardGui") and (child.Name=="NexESP_Billboard")) then child:Destroy();end end local billboard=Instance.new("BillboardGui");billboard.Name="NexESP_Billboard";billboard.Size=UDim2.new(0,200,0,32);billboard.StudsOffset=Vector3.new(0,2.5,0);billboard.AlwaysOnTop=true;billboard.MaxDistance=1000;billboard.Adornee=head;billboard.Parent=head;local label=Instance.new("TextLabel",billboard);label.Size=UDim2.new(1,0,1,0);label.BackgroundTransparency=1;label.Font=Enum.Font.SourceSansBold;label.TextSize=16;label.TextScaled=false;label.Text=text or "" ;label.TextColor3=color or Color3.new(1,1,1) ;label.TextStrokeTransparency=0.6;label.ZIndex=1000;return billboard;end local function createHighlightForCharacter(character,color) if  not character then return nil;end for _,child in ipairs(character:GetChildren()) do if (child:IsA("Highlight") and (child.Name=="NexESP_Highlight")) then child:Destroy();end end local highlight=Instance.new("Highlight");highlight.Name="NexESP_Highlight";highlight.Adornee=character;highlight.FillColor=color;highlight.FillTransparency=0.4;highlight.OutlineTransparency=1;highlight.Parent=character;return highlight;end local function addESP(p,col) if esps[p] then removeESP(p);end if ( not p or  not p.Parent) then return;end local function setupESP(character) if  not character then return;end local billboard=createBillboardForCharacter(character,p.DisplayName or p.Name ,col);local highlight=createHighlightForCharacter(character,col);if ( not billboard or  not highlight) then return;end esps[p]={billboard=billboard,highlight=highlight,character=character,color=col,characterConn=nil};end if p.Character then setupESP(p.Character);end local conn=p.CharacterAdded:Connect(function(char) if esps[p] then removeESP(p);end setupESP(char);end);if esps[p] then esps[p].characterConn=conn;end end local function removeESP(p) local e=esps[p];if e then if e.billboard then pcall(function() e.billboard:Destroy();end);end if e.highlight then pcall(function() e.highlight:Destroy();end);end if e.characterConn then pcall(function() e.characterConn:Disconnect();end);end esps[p]=nil;end end local function updateAllESPs() local shouldHaveESP={};if UserSettings.espEnabled then for _,player in ipairs(Players:GetPlayers()) do if (player~=LocalPlayer) then local id=player.UserId;if (blockPlayerSet[id] and UserSettings.blockEnabled) then shouldHaveESP[player]=Color3.fromRGB(0,150,0);elseif (targetPlayerSet[id] and UserSettings.targetEnabled) then shouldHaveESP[player]=Color3.fromRGB(150,0,0);end end end end for player,espData in pairs(esps) do if  not shouldHaveESP[player] then removeESP(player);elseif shouldHaveESP[player] then local expectedColor=shouldHaveESP[player];local currentColor=espData.color;if (currentColor~=expectedColor) then removeESP(player);addESP(player,expectedColor);end end end for player,color in pairs(shouldHaveESP) do if  not esps[player] then addESP(player,color);end end end local function createOrUpdateEntry(id,listType,p) id=tonumber(id);if  not id then return;end local listFrame=((listType=="block") and blockListFrame) or targetListFrame ;if (uiEntries[id] and (uiEntries[id].listType~=listType)) then pcall(function() uiEntries[id].frame:Destroy();end);uiEntries[id]=nil;end if  not uiEntries[id] then local entryFrame=Instance.new("Frame",listFrame);entryFrame.Size=UDim2.new(1, -8,0,30);entryFrame.BackgroundTransparency=0;entryFrame.BackgroundColor3=Color3.fromRGB(0,0,0);entryFrame.BorderSizePixel=0;entryFrame.ZIndex=25;Instance.new("UICorner",entryFrame).CornerRadius=UDim.new(0,6);local nameLabel=Instance.new("TextLabel",entryFrame);nameLabel.Size=UDim2.new(1, -40,1,0);nameLabel.Position=UDim2.new(0,8,0,0);nameLabel.BackgroundTransparency=1;nameLabel.Font=Enum.Font.SourceSans;nameLabel.TextSize=14;nameLabel.TextXAlignment=Enum.TextXAlignment.Left;nameLabel.TextColor3=THEME.text;nameLabel.ZIndex=26;local remBtn=Instance.new("TextButton",entryFrame);remBtn.Size=UDim2.new(0,28,0,22);remBtn.Position=UDim2.new(1, -36,0,4);remBtn.Text="X";remBtn.Font=Enum.Font.SourceSansBold;remBtn.TextSize=14;remBtn.TextColor3=THEME.text;remBtn.BackgroundColor3=Color3.fromRGB(160,40,40);remBtn.AutoButtonColor=false;Instance.new("UICorner",remBtn).CornerRadius=UDim.new(0,6);remBtn.ZIndex=26;uiEntries[id]={frame=entryFrame,label=nameLabel,online=false,listType=listType};remBtn.MouseButton1Click:Connect(function() if uiEntries[id] then local lt=uiEntries[id].listType;if (lt=="block") then blockPlayerSet[id]=nil;for i= #blockPlayerIds,1, -1 do if (blockPlayerIds[i]==id) then table.remove(blockPlayerIds,i);end end else targetPlayerSet[id]=nil;for i= #targetPlayerIds,1, -1 do if (targetPlayerIds[i]==id) then table.remove(targetPlayerIds,i);end end end pcall(function() uiEntries[id].frame:Destroy();end);uiEntries[id]=nil;persistLists();updateAllESPs();local function reflow(frame) local idx=0;for _,child in ipairs(frame:GetChildren()) do if child:IsA("Frame") then child.Position=UDim2.new(0,4,0,idx * 34 );idx=idx + 1 ;end end frame.CanvasSize=UDim2.new(0,0,0,idx * 34 );end reflow(blockListFrame);reflow(targetListFrame);end end);end local entry=uiEntries[id];if  not entry then return;end entry.listType=listType;entry.label.Text=getDisplayForId(id,p);entry.online=p~=nil ;if entry.online then entry.label.TextColor3=THEME.success;entry.frame.BackgroundTransparency=0.03;else entry.label.TextColor3=THEME.muted;entry.frame.BackgroundTransparency=0;entry.frame.BackgroundColor3=Color3.fromRGB(22,22,22);end if p then lastKnownNames[id]=getDisplayForId(id,p);UserSettings.lastKnownNames=lastKnownNames;saveSettings();end local function reflowSorted(whichList) local entries={};for uid,data in pairs(uiEntries) do if (data.listType==whichList) then table.insert(entries,{id=uid,online=data.online,frame=data.frame});end end table.sort(entries,function(a,b) if (a.online~=b.online) then return a.online and  not b.online ;end return tostring(a.id)<tostring(b.id) ;end);local idx=0;for _,e in ipairs(entries) do e.frame.Position=UDim2.new(0,4,0,idx * 34 );idx=idx + 1 ;end if (whichList=="block") then blockListFrame.CanvasSize=UDim2.new(0,0,0,idx * 34 );end if (whichList=="target") then targetListFrame.CanvasSize=UDim2.new(0,0,0,idx * 34 );end end reflowSorted("block");reflowSorted("target");end local function addPlayerByInputToList(inputText,listType) if ( not inputText or (inputText=="")) then return false;end local maybeId=tonumber(inputText);if maybeId then local foundPlayer=nil;for _,p in ipairs(Players:GetPlayers()) do if (p.UserId==maybeId) then foundPlayer=p;break;end end if (listType=="block") then if blockPlayerSet[maybeId] then return true;end blockPlayerSet[maybeId]=true;table.insert(blockPlayerIds,maybeId);else if targetPlayerSet[maybeId] then return true;end targetPlayerSet[maybeId]=true;table.insert(targetPlayerIds,maybeId);end if foundPlayer then createOrUpdateEntry(maybeId,listType,foundPlayer);lastKnownNames[maybeId]=getDisplayForId(maybeId,foundPlayer);updateAllESPs();else createOrUpdateEntry(maybeId,listType,nil);end persistLists();return true;end local found=nil;for _,p in ipairs(Players:GetPlayers()) do if ((p~=LocalPlayer) and matchNameInput(inputText,p)) then found=p;break;end end if  not found then return false;end local id=found.UserId;if (listType=="block") then if blockPlayerSet[id] then return true;end blockPlayerSet[id]=true;table.insert(blockPlayerIds,id);else if targetPlayerSet[id] then return true;end targetPlayerSet[id]=true;table.insert(targetPlayerIds,id);end createOrUpdateEntry(id,listType,found);lastKnownNames[id]=getDisplayForId(id,found);updateAllESPs();persistLists();return true;end blockAddBtn.MouseButton1Click:Connect(function() local txt=blockTextBox.Text;if addPlayerByInputToList(txt,"block") then blockTextBox.Text="";else spawn(function() local orig=blockTextBox.BackgroundColor3;blockTextBox.BackgroundColor3=Color3.fromRGB(120,40,40);wait(0.25);blockTextBox.BackgroundColor3=orig;end);end end);targetAddBtn.MouseButton1Click:Connect(function() local txt=targetTextBox.Text;if addPlayerByInputToList(txt,"target") then targetTextBox.Text="";else spawn(function() local orig=targetTextBox.BackgroundColor3;targetTextBox.BackgroundColor3=Color3.fromRGB(120,40,40);wait(0.25);targetTextBox.BackgroundColor3=orig;end);end end);for _,id in ipairs(blockPlayerIds) do local onlinePlayer=nil;for _,p in ipairs(Players:GetPlayers()) do if (p.UserId==id) then onlinePlayer=p;break;end end createOrUpdateEntry(id,"block",onlinePlayer);end for _,id in ipairs(targetPlayerIds) do local onlinePlayer=nil;for _,p in ipairs(Players:GetPlayers()) do if (p.UserId==id) then onlinePlayer=p;break;end end createOrUpdateEntry(id,"target",onlinePlayer);end Players.PlayerAdded:Connect(function(p) local id=p.UserId;lastKnownNames[id]=getDisplayForId(id,p);UserSettings.lastKnownNames=lastKnownNames;saveSettings();if (blockPlayerSet[id] or targetPlayerSet[id]) then createOrUpdateEntry(id,(blockPlayerSet[id] and "block") or (targetPlayerSet[id] and "target") ,p);updateAllESPs();end end);Players.PlayerRemoving:Connect(function(p) local id=p.UserId;if uiEntries[id] then createOrUpdateEntry(id,uiEntries[id].listType,nil);end removeESP(p);end);local function isAllowedTarget(p) if  not p then return true;end local id=p.UserId;if (UserSettings.targetEnabled and ( #targetPlayerIds>0)) then return targetPlayerSet[id]==true ;end if (UserSettings.blockEnabled and ( #blockPlayerIds>0)) then return  not (blockPlayerSet[id]==true);end return true;end local espRow=Instance.new("Frame",targetContent);espRow.Size=UDim2.new(1, -24,0,36);espRow.Position=UDim2.new(0,12,0,4);espRow.BackgroundTransparency=1;espRow.ZIndex=11;local espLabel=Instance.new("TextLabel",espRow);espLabel.Size=UDim2.new(0.5,0,1,0);espLabel.Position=UDim2.new(0,8,0,0);espLabel.BackgroundTransparency=1;espLabel.Text="Enable ESP";espLabel.Font=Enum.Font.SourceSans;espLabel.TextSize=14;espLabel.TextColor3=THEME.text;espLabel.TextXAlignment=Enum.TextXAlignment.Left;espLabel.ZIndex=11;local espToggleBg=Instance.new("Frame",espRow);espToggleBg.Size=UDim2.new(0,60,0,28);espToggleBg.Position=UDim2.new(1, -72,0,4);espToggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);espToggleBg.ZIndex=11;Instance.new("UICorner",espToggleBg).CornerRadius=UDim.new(0,12);local espKnob=Instance.new("Frame",espToggleBg);espKnob.Size=UDim2.new(0,24,0,24);espKnob.Position=UDim2.new(0,2,0,2);espKnob.BackgroundColor3=Color3.fromRGB(235,235,235);Instance.new("UICorner",espKnob).CornerRadius=UDim.new(1,0);espKnob.ZIndex=12;local function setEspToggleState(on) UserSettings.espEnabled=on;if on then espToggleBg.BackgroundColor3=THEME.accent;espKnob.Position=UDim2.new(1, -26,0,2);espKnob.BackgroundColor3=Color3.fromRGB(18,18,18);updateAllESPs();else espToggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);espKnob.Position=UDim2.new(0,2,0,2);espKnob.BackgroundColor3=Color3.fromRGB(235,235,235);for player in pairs(esps) do removeESP(player);end end saveSettings();end setEspToggleState(UserSettings.espEnabled);espToggleBg.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then setEspToggleState( not UserSettings.espEnabled);end end);blockToggle.MouseButton1Click:Connect(function() UserSettings.blockEnabled= not UserSettings.blockEnabled;refreshBlockToggleVisual();saveSettings();updateAllESPs();end);targetToggle.MouseButton1Click:Connect(function() UserSettings.targetEnabled= not UserSettings.targetEnabled;refreshTargetToggleVisual();saveSettings();updateAllESPs();end);local function setupButtonClick(button,actionType) button.MouseButton1Click:Connect(function() if customMode then openConfigMenu(button);return;end if (actionType=="Grab") then EquipTool("Grab");local closestPlayer=GetClosestPlayer();if (closestPlayer and closestPlayer.Character) then if  not isAllowedTarget(closestPlayer) then return;end highlightPlayer(closestPlayer.Character);local args={[1]=closestPlayer.Character.HumanoidRootPart,[2]="Grab",[3]=Vector3.new(0,0,0),[4]=CFrame.new()};ExecuteAction("Grab",unpack(args));end elseif (actionType=="Drag") then EquipTool("Drag");local closestPlayer=GetClosestPlayer();if (closestPlayer and closestPlayer.Character) then if  not isAllowedTarget(closestPlayer) then return;end highlightPlayer(closestPlayer.Character);ExecuteAction("Drag",closestPlayer.Character.HumanoidRootPart,closestPlayer.Character.HumanoidRootPart.Position,closestPlayer.Character.HumanoidRootPart.CFrame);end elseif (actionType=="Taser") then EquipTool("Taser");local targetPlayer=GetPlayerLookingAt() or GetClosestPlayer() ;if (targetPlayer and targetPlayer.Character) then if  not isAllowedTarget(targetPlayer) then return;end highlightPlayer(targetPlayer.Character);ExecuteAction("Taser",targetPlayer.Character.Head,targetPlayer.Character.HumanoidRootPart.Position,targetPlayer.Character.HumanoidRootPart.CFrame);else local localCharacter=LocalPlayer.Character;if (localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")) then ExecuteAction("Taser",localCharacter.Head,localCharacter.HumanoidRootPart.Position + (localCharacter.HumanoidRootPart.CFrame.LookVector * 10) ,localCharacter.HumanoidRootPart.CFrame);end end elseif (actionType=="Launcher") then EquipTool("Grenade Launcher");local targetPlayer=GetPlayerLookingAt();if (targetPlayer and targetPlayer.Character) then if  not isAllowedTarget(targetPlayer) then return;end highlightPlayer(targetPlayer.Character);ExecuteAction("Grenade Launcher",targetPlayer.Character.Head,targetPlayer.Character.HumanoidRootPart.Position,targetPlayer.Character.HumanoidRootPart.CFrame);end elseif (actionType=="Sit") then local humanoid=player.Character and player.Character:FindFirstChild("Humanoid") ;if humanoid then humanoid.Sit=true;end end end);end setupButtonClick(grabButton,"Grab");setupButtonClick(dragButton,"Drag");setupButtonClick(taserButton,"Taser");setupButtonClick(launcherButton,"Launcher");setupButtonClick(sitButton,"Sit");do local defaultGrabPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY);local defaultSitPos=UDim2.new(1, -leftOffset,0,buttonStartY);local defaultAutoPos=UDim2.new(1, -leftOffset,0,buttonStartY + buttonSpacing );local defaultDragPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + buttonSpacing );local defaultTaserPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 2) );local defaultLauncherPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 3) );if (UserSettings.grabButtonVisible~=nil) then grabButton.Visible=UserSettings.grabButtonVisible;end if (UserSettings.sitButtonVisible~=nil) then sitButton.Visible=UserSettings.sitButtonVisible;end if (UserSettings.autoSitFrameVisible~=nil) then autoSitFrame.Visible=UserSettings.autoSitFrameVisible;end if (UserSettings.dragButtonVisible~=nil) then dragButton.Visible=UserSettings.dragButtonVisible;end if (UserSettings.taserButtonVisible~=nil) then taserButton.Visible=UserSettings.taserButtonVisible;end if (UserSettings.launcherButtonVisible~=nil) then launcherButton.Visible=UserSettings.launcherButtonVisible;end if (UserSettings.grabButtonPosition and ( #UserSettings.grabButtonPosition==4)) then grabButton.Position=tableToUDim2(UserSettings.grabButtonPosition,defaultGrabPos);else grabButton.Position=defaultGrabPos;end if (UserSettings.sitButtonPosition and ( #UserSettings.sitButtonPosition==4)) then sitButton.Position=tableToUDim2(UserSettings.sitButtonPosition,defaultSitPos);else sitButton.Position=defaultSitPos;end if (UserSettings.autoSitFramePosition and ( #UserSettings.autoSitFramePosition==4)) then autoSitFrame.Position=tableToUDim2(UserSettings.autoSitFramePosition,defaultAutoPos);else autoSitFrame.Position=defaultAutoPos;end if (UserSettings.dragButtonPosition and ( #UserSettings.dragButtonPosition==4)) then dragButton.Position=tableToUDim2(UserSettings.dragButtonPosition,defaultDragPos);else dragButton.Position=defaultDragPos;end if (UserSettings.taserButtonPosition and ( #UserSettings.taserButtonPosition==4)) then taserButton.Position=tableToUDim2(UserSettings.taserButtonPosition,defaultTaserPos);else taserButton.Position=defaultTaserPos;end if (UserSettings.launcherButtonPosition and ( #UserSettings.launcherButtonPosition==4)) then launcherButton.Position=tableToUDim2(UserSettings.launcherButtonPosition,defaultLauncherPos);else launcherButton.Position=defaultLauncherPos;end if (UserSettings.grabButtonSize and ( #UserSettings.grabButtonSize==1)) then grabButton.Size=UDim2.new(0,UserSettings.grabButtonSize[1],0,UserSettings.grabButtonSize[1]);end if (UserSettings.sitButtonSize and ( #UserSettings.sitButtonSize==1)) then sitButton.Size=UDim2.new(0,UserSettings.sitButtonSize[1],0,UserSettings.sitButtonSize[1]);end if (UserSettings.autoSitFrameSize and ( #UserSettings.autoSitFrameSize==1)) then autoSitFrame.Size=UDim2.new(0,UserSettings.autoSitFrameSize[1],0,UserSettings.autoSitFrameSize[1]);end if (UserSettings.dragButtonSize and ( #UserSettings.dragButtonSize==1)) then dragButton.Size=UDim2.new(0,UserSettings.dragButtonSize[1],0,UserSettings.dragButtonSize[1]);end if (UserSettings.taserButtonSize and ( #UserSettings.taserButtonSize==1)) then taserButton.Size=UDim2.new(0,UserSettings.taserButtonSize[1],0,UserSettings.taserButtonSize[1]);end if (UserSettings.launcherButtonSize and ( #UserSettings.launcherButtonSize==1)) then launcherButton.Size=UDim2.new(0,UserSettings.launcherButtonSize[1],0,UserSettings.launcherButtonSize[1]);end end refreshBlockToggleVisual();refreshTargetToggleVisual();if UserSettings.espEnabled then spawn(function() wait(0.2);updateAllESPs();end);end end
