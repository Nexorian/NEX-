do local Players=game:GetService("Players");local ReplicatedStorage=game:GetService("ReplicatedStorage");local TextChatService=game:GetService("TextChatService");local UserInputService=game:GetService("UserInputService");local Camera=workspace.CurrentCamera;local RunService=game:GetService("RunService");local TweenService=game:GetService("TweenService");local HttpService=game:GetService("HttpService");local LocalPlayer=Players.LocalPlayer;local player=LocalPlayer;local gui=Instance.new("ScreenGui",player.PlayerGui);gui.Name="ControlPanelGUI";gui.ResetOnSpawn=false;gui.ZIndexBehavior=Enum.ZIndexBehavior.Sibling;local DEFAULT_SETTINGS={grabButtonVisible=true,sitButtonVisible=true,autoSitFrameVisible=true,panelVisible=true,dragButtonVisible=true,taserButtonVisible=true,launcherButtonVisible=true,grabButtonPosition=nil,sitButtonPosition=nil,dragButtonPosition=nil,taserButtonPosition=nil,launcherButtonPosition=nil,autoSitFramePosition=nil,grabButtonSize=nil,sitButtonSize=nil,dragButtonSize=nil,taserButtonSize=nil,launcherButtonSize=nil,autoSitFrameSize={64},panelPosition={0,12,0.05,0},blockEnabled=true,targetEnabled=true,blockPlayerIds={},targetPlayerIds={},lastKnownNames={},espEnabled=false,autoSitEnabled=false};local UserSettings=table.clone(DEFAULT_SETTINGS);local function saveSettings() if pcall(function() return writefile;end) then pcall(function() writefile("nex_hub.json",HttpService:JSONEncode(UserSettings));end);end end local function loadSettings() if  not (pcall(function() return isfile;end) and isfile("nex_hub.json")) then return;end local ok,data=pcall(function() return HttpService:JSONDecode(readfile("nex_hub.json"));end);if (ok and (type(data)=="table")) then for k,v in pairs(data) do UserSettings[k]=v;end end end loadSettings();local blockPlayerIds={};local targetPlayerIds={};local blockPlayerSet={};local targetPlayerSet={};local lastKnownNames={};if (type(UserSettings.blockPlayerIds)=="table") then for _,id in ipairs(UserSettings.blockPlayerIds) do blockPlayerIds[ #blockPlayerIds + 1 ]=id;blockPlayerSet[id]=true;end end if (type(UserSettings.targetPlayerIds)=="table") then for _,id in ipairs(UserSettings.targetPlayerIds) do targetPlayerIds[ #targetPlayerIds + 1 ]=id;targetPlayerSet[id]=true;end end if (type(UserSettings.lastKnownNames)=="table") then for id,n in pairs(UserSettings.lastKnownNames) do lastKnownNames[tonumber(id)]=n;end end local function persistLists() UserSettings.blockPlayerIds=blockPlayerIds;UserSettings.targetPlayerIds=targetPlayerIds;UserSettings.lastKnownNames=lastKnownNames;saveSettings();end local function tableToUDim2(t,fallback) if ((type(t)=="table") and ( #t==4)) then return UDim2.new(t[1],t[2],t[3],t[4]);end return fallback;end local function udim2ToTable(ud) return {ud.X.Scale,ud.X.Offset,ud.Y.Scale,ud.Y.Offset};end local THEME={bg=Color3.fromRGB(18,30,35),panelAccent=Color3.fromRGB(28,40,48),soft=Color3.fromRGB(45,50,56),accent=Color3.fromRGB(0,150,136),text=Color3.fromRGB(230,230,230),success=Color3.fromRGB(40,200,100),muted=Color3.fromRGB(130,130,130),error=Color3.fromRGB(180,60,60)};local colorMap={Grab=Color3.fromRGB(66,135,245),Drag=Color3.fromRGB(50,205,50),Taser=Color3.fromRGB(255,215,0),["Launcher Grenade"]=Color3.fromRGB(220,20,60),Sit=Color3.fromRGB(255,255,255),["Auto Sit"]=Color3.fromRGB(255,165,0)};local customMode=false;local currentDragConnections={};local currentDragTarget=nil;local defaultConfig={};local toolButtons={};local isConfigMenuOpen=false;local buttonSnapshots={};local function setupButtonAnimations(button,originalColor,hoverColor,clickColor) local animationData={originalSize=button.Size,originalBackgroundColor=button.BackgroundColor3,originalTextColor=button.TextColor3};button.MouseEnter:Connect(function() if customMode then return;end local tweenInfo=TweenInfo.new(0.15,Enum.EasingStyle.Quad,Enum.EasingDirection.Out);local scaleTween=TweenService:Create(button,tweenInfo,{Size=UDim2.new(0,animationData.originalSize.X.Offset * 1.1 ,0,animationData.originalSize.Y.Offset * 1.1 )});local colorTween=TweenService:Create(button,tweenInfo,{BackgroundColor3=hoverColor or Color3.fromRGB(math.clamp((originalColor.R * 255) + 20 ,0,255),math.clamp((originalColor.G * 255) + 20 ,0,255),math.clamp((originalColor.B * 255) + 20 ,0,255)) });local textTween=TweenService:Create(button,tweenInfo,{TextColor3=Color3.fromRGB(255,255,255)});scaleTween:Play();colorTween:Play();textTween:Play();end);button.MouseLeave:Connect(function() if customMode then return;end local tweenInfo=TweenInfo.new(0.2,Enum.EasingStyle.Quad,Enum.EasingDirection.Out);local scaleTween=TweenService:Create(button,tweenInfo,{Size=animationData.originalSize});local colorTween=TweenService:Create(button,tweenInfo,{BackgroundColor3=animationData.originalBackgroundColor});local textTween=TweenService:Create(button,tweenInfo,{TextColor3=animationData.originalTextColor});scaleTween:Play();colorTween:Play();textTween:Play();end);button.MouseButton1Down:Connect(function() if customMode then return;end local tweenInfo=TweenInfo.new(0.1,Enum.EasingStyle.Quad,Enum.EasingDirection.Out);local scaleTween=TweenService:Create(button,tweenInfo,{Size=UDim2.new(0,animationData.originalSize.X.Offset * 0.95 ,0,animationData.originalSize.Y.Offset * 0.95 )});local colorTween=TweenService:Create(button,tweenInfo,{BackgroundColor3=clickColor or Color3.fromRGB(math.clamp((originalColor.R * 255) -30 ,0,255),math.clamp((originalColor.G * 255) -30 ,0,255),math.clamp((originalColor.B * 255) -30 ,0,255)) });scaleTween:Play();colorTween:Play();end);button.MouseButton1Up:Connect(function() if customMode then return;end local tweenInfo=TweenInfo.new(0.15,Enum.EasingStyle.Quad,Enum.EasingDirection.Out);local scaleTween=TweenService:Create(button,tweenInfo,{Size=UDim2.new(0,animationData.originalSize.X.Offset * 1.1 ,0,animationData.originalSize.Y.Offset * 1.1 )});local colorTween=TweenService:Create(button,tweenInfo,{BackgroundColor3=hoverColor or Color3.fromRGB(math.clamp((originalColor.R * 255) + 20 ,0,255),math.clamp((originalColor.G * 255) + 20 ,0,255),math.clamp((originalColor.B * 255) + 20 ,0,255)) });scaleTween:Play();colorTween:Play();end);return animationData;end local buttonAnimationData={};local currentTool="Grab";local toolOrder={"Leafblower","Arm Rocket","Fishing Rod","Snowglobe","Grab","Drag","Taser","Mind Control","Grenade Launcher"};local lastActionTime=0;local function EquipTool(targetTool) if (currentTool==targetTool) then return;end local currentIndex,targetIndex=1,1;for i,tool in ipairs(toolOrder) do if (tool==currentTool) then currentIndex=i;end if (tool==targetTool) then targetIndex=i;end end local forwardSteps=((targetIndex>currentIndex) and (targetIndex-currentIndex)) or (( #toolOrder-currentIndex) + targetIndex) ;local backwardSteps=((currentIndex>targetIndex) and (currentIndex-targetIndex)) or (( #toolOrder-targetIndex) + currentIndex) ;local stepDirection=((forwardSteps<=backwardSteps) and 1) or  -1 ;local i=currentIndex;while i~=targetIndex  do i=i + stepDirection ;if (i> #toolOrder) then i=1;end if (i<1) then i= #toolOrder;end local args={[1]=toolOrder[i]};if (ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("EquipTool")) then ReplicatedStorage.Events.EquipTool:FireServer(unpack(args));end if ((toolOrder[i]=="Taser") or (toolOrder[i]=="Grab") or (toolOrder[i]=="Drag")) then wait(0.02);else wait(0.05);end end currentTool=targetTool;lastActionTime=os.clock();end local function cleanupCurrentDrag() for _,c in ipairs(currentDragConnections) do pcall(function() c:Disconnect();end);end currentDragConnections={};currentDragTarget=nil;end local function makeDraggable(frame,dragHandle) dragHandle=dragHandle or frame ;local dragging,dragStart,startPos;dragHandle.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then dragging=true;dragStart=input.Position;startPos=frame.Position;input.Changed:Connect(function() if (input.UserInputState==Enum.UserInputState.End) then dragging=false;local ti=TweenInfo.new(0.12,Enum.EasingStyle.Quad,Enum.EasingDirection.Out);pcall(function() TweenService:Create(frame,ti,{Position=frame.Position}):Play();end);end end);end end);dragHandle.InputChanged:Connect(function(input) if  not dragging then return;end if ((input.UserInputType~=Enum.UserInputType.MouseMovement) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end local delta=input.Position-dragStart ;frame.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset + delta.X ,startPos.Y.Scale,startPos.Y.Offset + delta.Y );end);end local function sendMessage(msg) if ( not msg or (msg=="")) then return;end local ok,channel=pcall(function() return TextChatService:FindFirstChild("TextChannels") and TextChatService.TextChannels:FindFirstChild("RBXGeneral") ;end);if (ok and channel) then pcall(function() channel:SendAsync(msg);end);end end local function GetClosestPlayer() local closestPlayer=nil;local closestDistance=math.huge;local localCharacter=LocalPlayer.Character;if ( not localCharacter or  not localCharacter:FindFirstChild("HumanoidRootPart")) then return nil;end local localPosition=localCharacter.HumanoidRootPart.Position;for _,p in pairs(Players:GetPlayers()) do if (p~=LocalPlayer) then local character=p.Character;if (character and character:FindFirstChild("HumanoidRootPart")) then local distance=(character.HumanoidRootPart.Position-localPosition).Magnitude;if (distance<closestDistance) then closestDistance=distance;closestPlayer=p;end end end end return closestPlayer;end local function GetClosestPlayerWithinRange(maxRange) local closestPlayer=nil;local closestDistance=math.huge;local localCharacter=LocalPlayer.Character;if ( not localCharacter or  not localCharacter:FindFirstChild("HumanoidRootPart")) then return nil;end local localPosition=localCharacter.HumanoidRootPart.Position;for _,p in pairs(Players:GetPlayers()) do if (p~=LocalPlayer) then local character=p.Character;if (character and character:FindFirstChild("HumanoidRootPart")) then local distance=(character.HumanoidRootPart.Position-localPosition).Magnitude;if ((distance<=maxRange) and (distance<closestDistance)) then closestDistance=distance;closestPlayer=p;end end end end return closestPlayer;end local function GetPlayerLookingAt(maxRange) local camera=workspace.CurrentCamera;local mouse=LocalPlayer:GetMouse();local ray=camera:ScreenPointToRay(mouse.X,mouse.Y);local direction=ray.Direction * (maxRange or 1000) ;local raycastResult=workspace:Raycast(ray.Origin,direction);if (raycastResult and raycastResult.Instance) then local hitPart=raycastResult.Instance;for _,p in pairs(Players:GetPlayers()) do if ((p~=LocalPlayer) and p.Character and p.Character:IsAncestorOf(hitPart)) then if maxRange then local distance=(p.Character.HumanoidRootPart.Position-camera.CFrame.Position).Magnitude;if (distance<=maxRange) then return p;end else return p;end end end end local screenCenter=Vector2.new(camera.ViewportSize.X/2 ,camera.ViewportSize.Y/2 );local closestPlayer=nil;local closestScreenDistance=math.huge;for _,p in pairs(Players:GetPlayers()) do if ((p~=LocalPlayer) and p.Character and p.Character:FindFirstChild("HumanoidRootPart")) then local playerPosition=p.Character.HumanoidRootPart.Position;local screenPosition,onScreen=camera:WorldToScreenPoint(playerPosition);if onScreen then if maxRange then local distance=(playerPosition-camera.CFrame.Position).Magnitude;if (distance>maxRange) then continue;end end local screenDistance=(Vector2.new(screenPosition.X,screenPosition.Y) -screenCenter).Magnitude;if (screenDistance<closestScreenDistance) then closestScreenDistance=screenDistance;closestPlayer=p;end end end end return closestPlayer;end local function GetPlayerAtScreenCenter(maxRange) local camera=workspace.CurrentCamera;local screenCenter=Vector2.new(camera.ViewportSize.X/2 ,camera.ViewportSize.Y/2 );local closestPlayer=nil;local closestScreenDistance=math.huge;for _,p in pairs(Players:GetPlayers()) do if ((p~=LocalPlayer) and p.Character and p.Character:FindFirstChild("HumanoidRootPart")) then local playerPosition=p.Character.HumanoidRootPart.Position;local screenPosition,onScreen=camera:WorldToScreenPoint(playerPosition);if onScreen then if maxRange then local distance=(playerPosition-camera.CFrame.Position).Magnitude;if (distance>maxRange) then continue;end end local screenDistance=(Vector2.new(screenPosition.X,screenPosition.Y) -screenCenter).Magnitude;if (screenDistance<closestScreenDistance) then closestScreenDistance=screenDistance;closestPlayer=p;end end end end return closestPlayer;end local function CalculateGrenadeTrajectory(startPos,targetPos,targetVelocity) local horizontalDistance=(Vector3.new(targetPos.X,0,targetPos.Z) -Vector3.new(startPos.X,0,startPos.Z)).Magnitude;local heightDifference=targetPos.Y-startPos.Y ;local initialVelocity=150;local gravity= -9.81 * 2 ;local predictionTime=math.clamp(horizontalDistance/100 ,0.3,1);local futurePos=targetPos + (targetVelocity * predictionTime) ;local heightAdjustment=0;if (horizontalDistance>30) then heightAdjustment=(horizontalDistance-30) * 0.8 ;if (horizontalDistance>100) then heightAdjustment=heightAdjustment + ((horizontalDistance-100) * 1.2) ;end end futurePos=futurePos + Vector3.new(0,heightAdjustment,0) ;local velocitySquared=initialVelocity * initialVelocity ;local distance=(futurePos-startPos).Magnitude;local horizontalDist=(Vector3.new(futurePos.X,0,futurePos.Z) -Vector3.new(startPos.X,0,startPos.Z)).Magnitude;local underRoot=(velocitySquared * velocitySquared) -(gravity * ((gravity * horizontalDist * horizontalDist) + (2 * (futurePos.Y-startPos.Y) * velocitySquared))) ;local angle=math.pi/4 ;if ((underRoot>=0) and (horizontalDist>0)) then angle=math.atan((velocitySquared-math.sqrt(underRoot))/(gravity * horizontalDist) );angle=math.clamp(angle,math.rad(20),math.rad(70));end local direction=(futurePos-startPos) * Vector3.new(1,0,1) ;local horizontalAngle=math.atan2(direction.Z,direction.X);local finalCFrame=CFrame.new(startPos) * CFrame.Angles(0,horizontalAngle,0) * CFrame.Angles( -angle,0,0) ;return futurePos,finalCFrame;end local function ExecuteAction(actionType,targetPart,targetPosition,targetCFrame) if (ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("Grab")) then local args={[1]=targetPart,[2]=actionType,[3]=targetPosition,[4]=targetCFrame};ReplicatedStorage.Events.Grab:FireServer(unpack(args));end end local function highlightPlayer(playerCharacter) if playerCharacter then local highlight=Instance.new("Highlight");highlight.FillColor=Color3.new(1,0,0);highlight.OutlineColor=Color3.new(0,0,0);highlight.Parent=playerCharacter;spawn(function() wait(0.1);pcall(function() highlight:Destroy();end);end);end end local function splitWords(s) local t={};for w in string.gmatch(s or "" ,"[%w]+") do table.insert(t,w);end return t;end local function buildInitials(s) local words=splitWords(s);local initials="";for _,w in ipairs(words) do initials=initials   .. (string.sub(w,1,1) or "") ;end return initials:lower();end local function matchNameInput(input,p) if ( not input or (input=="") or  not p) then return false;end local inputLower=tostring(input):lower();local nameLower=tostring(p.Name or "" ):lower();local displayLower=tostring(p.DisplayName or "" ):lower();if (string.find(nameLower,inputLower,1,true) or string.find(displayLower,inputLower,1,true)) then return true;end for _,token in ipairs(splitWords(nameLower)) do if (string.sub(token,1, #inputLower)==inputLower) then return true;end end for _,token in ipairs(splitWords(displayLower)) do if (string.sub(token,1, #inputLower)==inputLower) then return true;end end local nameInit=buildInitials(nameLower);local dispInit=buildInitials(displayLower);if ((inputLower==nameInit) or (inputLower==dispInit)) then return true;end return false;end local btnSizeDefault=64;local buttonSpacing=70;local rightMargin=20;local buttonStartY=50;local function createSquareButton(name,position,size,text,textColor) local btnSizeDefaultLocal=size or 64 ;local button=Instance.new("TextButton");button.Name=name;if (typeof(position)=="UDim2") then button.Position=position;else button.Position=UDim2.new(0,0,0,0);end button.Size=UDim2.new(0,btnSizeDefaultLocal,0,btnSizeDefaultLocal);button.BackgroundColor3=THEME.soft;button.TextColor3=textColor or THEME.text ;button.Font=Enum.Font.GothamBold;button.TextSize=14;button.TextWrapped=true;button.Text=text or "" ;button.AutoButtonColor=false;button.Active=true;button.Draggable=false;button.ZIndex=5;button.Parent=gui;Instance.new("UICorner",button).CornerRadius=UDim.new(0,10);local stroke=Instance.new("UIStroke",button);stroke.Color=Color3.fromRGB(20,20,20);stroke.Transparency=0.6;stroke.Thickness=1;defaultConfig[name]={Position=button.Position,Size=button.Size,Visible=true};toolButtons[name]=button;if ((name=="GrabButton") or (name=="DragButton") or (name=="TaserButton") or (name=="LauncherButton") or (name=="SitButton")) then buttonAnimationData[button]=setupButtonAnimations(button,button.BackgroundColor3,nil,nil);end return button;end local grabButton=createSquareButton("GrabButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY),btnSizeDefault,"GRAB",colorMap['Grab']);local dragButton=createSquareButton("DragButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + buttonSpacing ),btnSizeDefault,"DRAG",colorMap['Drag']);local taserButton=createSquareButton("TaserButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 2) ),btnSizeDefault,"TASER",colorMap['Taser']);local launcherButton=createSquareButton("LauncherButton",UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 3) ),btnSizeDefault,"GRENADE",colorMap["Launcher Grenade"]);local leftOffset=(btnSizeDefault * 2) + rightMargin + 40 ;local sitButton=createSquareButton("SitButton",UDim2.new(1, -leftOffset,0,buttonStartY),btnSizeDefault,"SIT",colorMap['Sit']);local autoSitFrame=Instance.new("Frame",gui);autoSitFrame.Name="AutoSitFrame";autoSitFrame.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);autoSitFrame.Position=UDim2.new(1, -leftOffset,0,buttonStartY + buttonSpacing );autoSitFrame.BackgroundColor3=THEME.soft;autoSitFrame.BackgroundTransparency=0.12;autoSitFrame.Active=true;autoSitFrame.Selectable=true;autoSitFrame.ZIndex=5;Instance.new("UICorner",autoSitFrame).CornerRadius=UDim.new(0,10);local stroke=Instance.new("UIStroke",autoSitFrame);stroke.Color=Color3.fromRGB(20,20,20);stroke.Transparency=0.6;stroke.Thickness=1;local autoButton=Instance.new("TextButton",autoSitFrame);autoButton.Name="AutoButton";autoButton.Size=UDim2.new(1,0,1,0);autoButton.Position=UDim2.new(0,0,0,0);autoButton.BackgroundTransparency=0;autoButton.BackgroundColor3=THEME.soft;autoButton.Text="AUTO SIT";autoButton.TextColor3=THEME.text;autoButton.Font=Enum.Font.GothamBold;autoButton.TextSize=14;autoButton.AutoButtonColor=false;autoButton.ZIndex=6;Instance.new("UICorner",autoButton).CornerRadius=UDim.new(0,10);local autoButtonStroke=Instance.new("UIStroke",autoButton);autoButtonStroke.Color=Color3.fromRGB(20,20,20);autoButtonStroke.Transparency=0.6;autoButtonStroke.Thickness=1;local autoSitEnabled=UserSettings.autoSitEnabled or false ;local HoldingManual=false;local Busy=false;local lastAutoSitTime=0;local autoSitRateLimit=0.5;local function IsInAbnormalState() local character=LocalPlayer.Character;if  not character then return false;end local humanoid=character:FindFirstChildOfClass("Humanoid");local rootPart=character:FindFirstChild("HumanoidRootPart");if ( not humanoid or  not rootPart) then return false;end local AngleX=math.abs(rootPart.Orientation.X);local AngleZ=math.abs(rootPart.Orientation.Z);if ((AngleX>70) or (AngleZ>70)) then return true;end return false;end local function isAlive() local char=LocalPlayer.Character;if  not char then return false;end local humanoid=char:FindFirstChildOfClass("Humanoid");if  not humanoid then return false;end if (humanoid.Health<=0) then return false;end if (humanoid:GetState()==Enum.HumanoidStateType.Dead) then return false;end return true;end local function SendSitCommand() sendMessage("/sit");end local function ExecuteSitJumpManual() if (Busy or  not isAlive()) then return;end Busy=true;SendSitCommand();local humanoid=LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") ;if humanoid then local startTime=tick();while  not humanoid.Sit and ((tick() -startTime)<0.6)  do wait();if humanoid.Sit then break;end end if humanoid.Sit then wait(math.random(30,120)/1000 );humanoid.Sit=false;wait(math.random(80,120)/1000 );humanoid.Jump=true;end end Busy=false;end local function ExecuteAutoSit() if (Busy or  not isAlive()) then return;end Busy=true;SendSitCommand();local humanoid=LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") ;if humanoid then local startTime=tick();while  not humanoid.Sit and ((tick() -startTime)<0.6)  do wait();if humanoid.Sit then break;end end if humanoid.Sit then wait(math.random(120,180)/1000 );humanoid.Sit=false;wait(math.random(120,180)/1000 );humanoid.Jump=true;end end Busy=false;end local function AutoCheckImproved() if  not autoSitEnabled then return;end if HoldingManual then return;end if  not isAlive() then return;end if IsInAbnormalState() then local now=tick();if ((now-lastAutoSitTime)<autoSitRateLimit) then return;end lastAutoSitTime=now;local humanoid=LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") ;if humanoid then pcall(function() humanoid:ChangeState(Enum.HumanoidStateType.Seated);end);end end end local function openConfigMenu(targetBtn) if ( not targetBtn or isConfigMenuOpen) then return;end isConfigMenuOpen=true;cleanupCurrentDrag();local existing=gui:FindFirstChild("ConfigMenu");if existing then existing:Destroy();end buttonSnapshots[targetBtn]={Position=targetBtn.Position,Size=targetBtn.Size};local menu=Instance.new("Frame",gui);menu.Name="ConfigMenu";menu.Size=UDim2.new(0,320,0,220);menu.AnchorPoint=Vector2.new(0.5,0.5);menu.Position=UDim2.new(0.5,0,0.5,0);menu.BackgroundColor3=THEME.panelAccent;menu.ZIndex=100;Instance.new("UICorner",menu).CornerRadius=UDim.new(0,10);local titleBar=Instance.new("Frame",menu);titleBar.Name="TitleBar";titleBar.Size=UDim2.new(1,0,0,32);titleBar.BackgroundTransparency=1;titleBar.Position=UDim2.new(0,0,0,0);titleBar.ZIndex=101;local title=Instance.new("TextLabel",titleBar);title.Name="Title";title.Size=UDim2.new(1, -52,1,0);title.Position=UDim2.new(0,12,0,0);title.BackgroundTransparency=1;title.Text="Configure: "   .. (tostring(targetBtn.Name)) ;title.Font=Enum.Font.SourceSansBold;title.TextSize=14;title.TextColor3=THEME.text;title.TextXAlignment=Enum.TextXAlignment.Left;title.ZIndex=101;local closeBtn=Instance.new("TextButton",titleBar);closeBtn.Name="CloseButton";closeBtn.Size=UDim2.new(0,36,0,24);closeBtn.Position=UDim2.new(1, -44,0,4);closeBtn.Text="X";closeBtn.Font=Enum.Font.SourceSansBold;closeBtn.TextSize=14;closeBtn.TextColor3=Color3.new(1,1,1);closeBtn.BackgroundColor3=Color3.fromRGB(80,80,80);closeBtn.AutoButtonColor=false;Instance.new("UICorner",closeBtn).CornerRadius=UDim.new(0,6);closeBtn.ZIndex=101;closeBtn.MouseButton1Click:Connect(function() cleanupCurrentDrag();if (menu and menu.Parent) then menu:Destroy();end isConfigMenuOpen=false;end);makeDraggable(menu,titleBar);local contentFrame=Instance.new("Frame",menu);contentFrame.Name="Content";contentFrame.Size=UDim2.new(1, -24,1, -44);contentFrame.Position=UDim2.new(0,12,0,40);contentFrame.BackgroundTransparency=1;contentFrame.ZIndex=100;local dragRow=Instance.new("Frame",contentFrame);dragRow.Name="DragRow";dragRow.Size=UDim2.new(1,0,0,30);dragRow.Position=UDim2.new(0,0,0,0);dragRow.BackgroundTransparency=1;local dragToggleLabel=Instance.new("TextLabel",dragRow);dragToggleLabel.Name="DragLabel";dragToggleLabel.Size=UDim2.new(0.6,0,1,0);dragToggleLabel.Position=UDim2.new(0,0,0,0);dragToggleLabel.BackgroundTransparency=1;dragToggleLabel.Text="Enable Drag";dragToggleLabel.Font=Enum.Font.SourceSans;dragToggleLabel.TextSize=13;dragToggleLabel.TextColor3=THEME.text;dragToggleLabel.TextXAlignment=Enum.TextXAlignment.Left;dragToggleLabel.ZIndex=100;local dragToggleBg=Instance.new("Frame",dragRow);dragToggleBg.Name="DragToggleBg";dragToggleBg.Size=UDim2.new(0,56,0,24);dragToggleBg.Position=UDim2.new(1, -56,0,3);dragToggleBg.BackgroundColor3=Color3.fromRGB(50,50,50);Instance.new("UICorner",dragToggleBg).CornerRadius=UDim.new(0,8);dragToggleBg.ZIndex=100;local dragKnob=Instance.new("Frame",dragToggleBg);dragKnob.Name="DragKnob";dragKnob.Size=UDim2.new(0,20,0,20);dragKnob.Position=UDim2.new(0,2,0,2);dragKnob.BackgroundColor3=Color3.fromRGB(235,235,235);Instance.new("UICorner",dragKnob).CornerRadius=UDim.new(1,0);dragKnob.ZIndex=101;local dragEnabled=false;local function enableDragOnTarget(on) cleanupCurrentDrag();if on then dragToggleBg.BackgroundColor3=THEME.accent;dragKnob.Position=UDim2.new(1, -22,0,2);dragKnob.BackgroundColor3=Color3.fromRGB(18,18,18);if  not targetBtn then return;end pcall(function() targetBtn.Active=true;targetBtn.Selectable=true;end);targetBtn.Draggable=true;currentDragTarget=targetBtn;local pointerStart,btnStartAbsX,btnStartAbsY;local connBegin=UserInputService.InputBegan:Connect(function(input) if ((input.UserInputType~=Enum.UserInputType.MouseButton1) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end local mousePos=input.Position or UserInputService:GetMouseLocation() ;local absPos=targetBtn.AbsolutePosition;local absSize=targetBtn.AbsoluteSize;if ((mousePos.X>=absPos.X) and (mousePos.X<=(absPos.X + absSize.X)) and (mousePos.Y>=absPos.Y) and (mousePos.Y<=(absPos.Y + absSize.Y))) then pointerStart=mousePos;btnStartAbsX=targetBtn.AbsolutePosition.X;btnStartAbsY=targetBtn.AbsolutePosition.Y;end end);local connMove=UserInputService.InputChanged:Connect(function(input) if ( not pointerStart or  not btnStartAbsX) then return;end if ((input.UserInputType~=Enum.UserInputType.MouseMovement) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end local currentPos=input.Position or UserInputService:GetMouseLocation() ;local delta=currentPos-pointerStart ;local newAbsX=btnStartAbsX + delta.X ;local newAbsY=btnStartAbsY + delta.Y ;local guiAbsPos=gui.AbsolutePosition;local relX=newAbsX-guiAbsPos.X ;local relY=newAbsY-guiAbsPos.Y ;pcall(function() targetBtn.Position=UDim2.new(0,relX,0,relY);end);end);local connEnd=UserInputService.InputEnded:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then pointerStart=nil;btnStartAbsX=nil;btnStartAbsY=nil;end end);table.insert(currentDragConnections,connBegin);table.insert(currentDragConnections,connMove);table.insert(currentDragConnections,connEnd);else dragToggleBg.BackgroundColor3=Color3.fromRGB(50,50,50);dragKnob.Position=UDim2.new(0,2,0,2);dragKnob.BackgroundColor3=Color3.fromRGB(235,235,235);if targetBtn then pcall(function() targetBtn.Draggable=false;end);end cleanupCurrentDrag();end dragEnabled=on;end dragToggleBg.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then enableDragOnTarget( not dragEnabled);end end);local separator1=Instance.new("Frame",contentFrame);separator1.Size=UDim2.new(1,0,0,1);separator1.Position=UDim2.new(0,0,0,38);separator1.BackgroundColor3=Color3.fromRGB(60,60,60);separator1.ZIndex=100;local sizeRow=Instance.new("Frame",contentFrame);sizeRow.Size=UDim2.new(1,0,0,50);sizeRow.Position=UDim2.new(0,0,0,45);sizeRow.BackgroundTransparency=1;sizeRow.ZIndex=100;local sliderLabel=Instance.new("TextLabel",sizeRow);sliderLabel.Size=UDim2.new(0.6,0,0,20);sliderLabel.Position=UDim2.new(0,0,0,0);sliderLabel.BackgroundTransparency=1;sliderLabel.Text="Size:";sliderLabel.Font=Enum.Font.SourceSans;sliderLabel.TextSize=13;sliderLabel.TextColor3=THEME.text;sliderLabel.TextXAlignment=Enum.TextXAlignment.Left;sliderLabel.ZIndex=100;local sizeValueLabel=Instance.new("TextLabel",sizeRow);sizeValueLabel.Size=UDim2.new(0.4,0,0,20);sizeValueLabel.Position=UDim2.new(0.6,0,0,0);sizeValueLabel.BackgroundTransparency=1;sizeValueLabel.Font=Enum.Font.SourceSansBold;sizeValueLabel.TextSize=13;sizeValueLabel.TextColor3=THEME.accent;sizeValueLabel.TextXAlignment=Enum.TextXAlignment.Right;sizeValueLabel.ZIndex=100;local track=Instance.new("Frame",sizeRow);track.Size=UDim2.new(1,0,0,20);track.Position=UDim2.new(0,0,0,25);track.BackgroundColor3=Color3.fromRGB(55,55,55);Instance.new("UICorner",track).CornerRadius=UDim.new(0,6);track.ZIndex=100;local fill=Instance.new("Frame",track);fill.Size=UDim2.new(0.5,0,1,0);fill.BackgroundColor3=THEME.accent;Instance.new("UICorner",fill).CornerRadius=UDim.new(0,6);fill.ZIndex=101;local handle=Instance.new("TextButton",track);handle.Size=UDim2.new(0,20,0,20);handle.Position=UDim2.new(0.5, -10,0,0);handle.Text="";handle.AutoButtonColor=false;handle.BackgroundColor3=Color3.fromRGB(240,240,240);Instance.new("UICorner",handle).CornerRadius=UDim.new(1,0);handle.ZIndex=102;local curSize=nil;if (targetBtn and targetBtn.Size and targetBtn.Size.X) then if (targetBtn.Size.X.Offset and (targetBtn.Size.X.Offset>0)) then curSize=targetBtn.Size.X.Offset;else curSize=btnSizeDefault;end else curSize=btnSizeDefault;end local minSize,maxSize=32,128;local normalized=(curSize-minSize)/(maxSize-minSize) ;normalized=math.clamp(normalized,0,1);fill.Size=UDim2.new(normalized,0,1,0);handle.Position=UDim2.new(normalized, -10,0,0);sizeValueLabel.Text=tostring(curSize)   .. "px" ;local sliding=false;local function updateSizeFromFraction(frac) local newSize=math.floor(minSize + ((maxSize-minSize) * frac) + 0.5 );if targetBtn then targetBtn.Size=UDim2.new(0,newSize,0,newSize);end sizeValueLabel.Text=tostring(newSize)   .. "px" ;end local function onSliderInputChanged(input) if  not sliding then return;end if ((input.UserInputType~=Enum.UserInputType.MouseMovement) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end local abs=input.Position or UserInputService:GetMouseLocation() ;local rPos=track.AbsolutePosition;local rSize=track.AbsoluteSize.X;local x=math.clamp(abs.X-rPos.X ,0,rSize);local frac=0;if (rSize>0) then frac=x/rSize ;end fill.Size=UDim2.new(frac,0,1,0);handle.Position=UDim2.new(frac, -10,0,0);updateSizeFromFraction(frac);end handle.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then sliding=true;input.Changed:Connect(function() if (input.UserInputState==Enum.UserInputState.End) then sliding=false;end end);end end);track.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then sliding=true;onSliderInputChanged(input);input.Changed:Connect(function() if (input.UserInputState==Enum.UserInputState.End) then sliding=false;end end);end end);local connSlide=UserInputService.InputChanged:Connect(onSliderInputChanged);table.insert(currentDragConnections,connSlide);local btnRow=Instance.new("Frame",contentFrame);btnRow.Size=UDim2.new(1,0,0,36);btnRow.Position=UDim2.new(0,0,1, -42);btnRow.BackgroundTransparency=1;btnRow.ZIndex=100;local saveBtn=Instance.new("TextButton",btnRow);saveBtn.Size=UDim2.new(0,120,0,28);saveBtn.Position=UDim2.new(0,12,0,4);saveBtn.Text="Save";saveBtn.Font=Enum.Font.SourceSansBold;saveBtn.TextSize=14;saveBtn.TextColor3=THEME.text;saveBtn.BackgroundColor3=THEME.accent;Instance.new("UICorner",saveBtn).CornerRadius=UDim.new(0,8);saveBtn.ZIndex=101;local cancelBtn=Instance.new("TextButton",btnRow);cancelBtn.Size=UDim2.new(0,120,0,28);cancelBtn.Position=UDim2.new(1, -132,0,4);cancelBtn.Text="Cancel";cancelBtn.Font=Enum.Font.SourceSansBold;cancelBtn.TextSize=14;cancelBtn.TextColor3=THEME.text;cancelBtn.BackgroundColor3=Color3.fromRGB(100,100,100);Instance.new("UICorner",cancelBtn).CornerRadius=UDim.new(0,8);cancelBtn.ZIndex=101;cancelBtn.MouseButton1Click:Connect(function() enableDragOnTarget(false);local snapshot=buttonSnapshots[targetBtn];if snapshot then targetBtn.Position=snapshot.Position;targetBtn.Size=snapshot.Size;end cleanupCurrentDrag();if (menu and menu.Parent) then menu:Destroy();end isConfigMenuOpen=false;end);saveBtn.MouseButton1Click:Connect(function() enableDragOnTarget(false);local function posToTable(ud) return {ud.X.Scale,ud.X.Offset,ud.Y.Scale,ud.Y.Offset};end if (targetBtn==grabButton) then if targetBtn.Position then UserSettings.grabButtonPosition=posToTable(targetBtn.Position);end if (type(targetBtn.Size.X.Offset)=="number") then UserSettings.grabButtonSize={targetBtn.Size.X.Offset};grabButton.Size=UDim2.new(0,UserSettings.grabButtonSize[1],0,UserSettings.grabButtonSize[1]);if buttonAnimationData[grabButton] then buttonAnimationData[grabButton].originalSize=grabButton.Size;end end elseif (targetBtn==sitButton) then if targetBtn.Position then UserSettings.sitButtonPosition=posToTable(targetBtn.Position);end if (type(targetBtn.Size.X.Offset)=="number") then UserSettings.sitButtonSize={targetBtn.Size.X.Offset};sitButton.Size=UDim2.new(0,UserSettings.sitButtonSize[1],0,UserSettings.sitButtonSize[1]);if buttonAnimationData[sitButton] then buttonAnimationData[sitButton].originalSize=sitButton.Size;end end elseif (targetBtn==autoSitFrame) then if targetBtn.Position then UserSettings.autoSitFramePosition=posToTable(targetBtn.Position);end if (type(targetBtn.Size.X.Offset)=="number") then UserSettings.autoSitFrameSize={targetBtn.Size.X.Offset};autoSitFrame.Size=UDim2.new(0,UserSettings.autoSitFrameSize[1],0,UserSettings.autoSitFrameSize[1]);end elseif (targetBtn==dragButton) then if targetBtn.Position then UserSettings.dragButtonPosition=posToTable(targetBtn.Position);end if (type(targetBtn.Size.X.Offset)=="number") then UserSettings.dragButtonSize={targetBtn.Size.X.Offset};dragButton.Size=UDim2.new(0,UserSettings.dragButtonSize[1],0,UserSettings.dragButtonSize[1]);if buttonAnimationData[dragButton] then buttonAnimationData[dragButton].originalSize=dragButton.Size;end end elseif (targetBtn==taserButton) then if targetBtn.Position then UserSettings.taserButtonPosition=posToTable(targetBtn.Position);end if (type(targetBtn.Size.X.Offset)=="number") then UserSettings.taserButtonSize={targetBtn.Size.X.Offset};taserButton.Size=UDim2.new(0,UserSettings.taserButtonSize[1],0,UserSettings.taserButtonSize[1]);if buttonAnimationData[taserButton] then buttonAnimationData[taserButton].originalSize=taserButton.Size;end end elseif (targetBtn==launcherButton) then if targetBtn.Position then UserSettings.launcherButtonPosition=posToTable(targetBtn.Position);end if (type(targetBtn.Size.X.Offset)=="number") then UserSettings.launcherButtonSize={targetBtn.Size.X.Offset};launcherButton.Size=UDim2.new(0,UserSettings.launcherButtonSize[1],0,UserSettings.launcherButtonSize[1]);if buttonAnimationData[launcherButton] then buttonAnimationData[launcherButton].originalSize=launcherButton.Size;end end end saveSettings();cleanupCurrentDrag();if (menu and menu.Parent) then menu:Destroy();end isConfigMenuOpen=false;end);local menuOpenTime=tick();local function closeIfClickedOutside(input) if (input.UserInputType~=Enum.UserInputType.MouseButton1) then return;end if ((tick() -menuOpenTime)<0.08) then return;end local mousePos=input.Position;local menuAbsPos=menu.AbsolutePosition;local menuAbsSize=menu.AbsoluteSize;if ((mousePos.X<menuAbsPos.X) or (mousePos.X>(menuAbsPos.X + menuAbsSize.X)) or (mousePos.Y<menuAbsPos.Y) or (mousePos.Y>(menuAbsPos.Y + menuAbsSize.Y))) then enableDragOnTarget(false);local snapshot=buttonSnapshots[targetBtn];if snapshot then targetBtn.Position=snapshot.Position;targetBtn.Size=snapshot.Size;end cleanupCurrentDrag();if (menu and menu.Parent) then menu:Destroy();end isConfigMenuOpen=false;end end local connClose=UserInputService.InputBegan:Connect(closeIfClickedOutside);table.insert(currentDragConnections,connClose);menu.Destroying:Connect(function() cleanupCurrentDrag();isConfigMenuOpen=false;end);end local panelToggle=createSquareButton("PanelToggle",UDim2.new(0,20,1, -84),48,"â‰¡",THEME.text);local panel=Instance.new("Frame",gui);panel.Name="Panel";panel.Size=UDim2.new(0,700,0,380);if (UserSettings.panelPosition and ( #UserSettings.panelPosition==4)) then panel.Position=tableToUDim2(UserSettings.panelPosition,UDim2.new(DEFAULT_SETTINGS.panelPosition[1],DEFAULT_SETTINGS.panelPosition[2],DEFAULT_SETTINGS.panelPosition[3],DEFAULT_SETTINGS.panelPosition[4]));else panel.Position=UDim2.new(DEFAULT_SETTINGS.panelPosition[1],DEFAULT_SETTINGS.panelPosition[2],DEFAULT_SETTINGS.panelPosition[3],DEFAULT_SETTINGS.panelPosition[4]);end panel.BackgroundColor3=THEME.bg;panel.BorderSizePixel=0;panel.Visible=((UserSettings.panelVisible==nil) and DEFAULT_SETTINGS.panelVisible) or UserSettings.panelVisible ;panel.ZIndex=10;Instance.new("UICorner",panel).CornerRadius=UDim.new(0,12);local panelTitleBar=Instance.new("Frame",panel);panelTitleBar.Size=UDim2.new(1,0,0,36);panelTitleBar.BackgroundTransparency=1;panelTitleBar.ZIndex=11;local panelTitle=Instance.new("TextLabel",panelTitleBar);panelTitle.Size=UDim2.new(1, -12,1,0);panelTitle.Position=UDim2.new(0,12,0,0);panelTitle.BackgroundTransparency=1;panelTitle.Text="Nex hub";panelTitle.Font=Enum.Font.SourceSansBold;panelTitle.TextSize=18;panelTitle.TextColor3=THEME.text;panelTitle.TextXAlignment=Enum.TextXAlignment.Left;panelTitle.ZIndex=11;makeDraggable(panel,panelTitleBar);local tabsBar=Instance.new("Frame",panel);tabsBar.Size=UDim2.new(1, -24,0,32);tabsBar.Position=UDim2.new(0,12,0,44);tabsBar.BackgroundTransparency=1;tabsBar.ZIndex=11;local mainTabBtn=Instance.new("TextButton",tabsBar);mainTabBtn.Size=UDim2.new(0.5, -6,1,0);mainTabBtn.Position=UDim2.new(0,0,0,0);mainTabBtn.Text="Main";mainTabBtn.Font=Enum.Font.SourceSansBold;mainTabBtn.TextSize=14;mainTabBtn.BackgroundColor3=THEME.accent;mainTabBtn.TextColor3=THEME.text;Instance.new("UICorner",mainTabBtn).CornerRadius=UDim.new(0,8);mainTabBtn.ZIndex=12;local targetTabBtn=Instance.new("TextButton",tabsBar);targetTabBtn.Size=UDim2.new(0.5, -6,1,0);targetTabBtn.Position=UDim2.new(0.5,12,0,0);targetTabBtn.Text="Target";targetTabBtn.Font=Enum.Font.SourceSansBold;targetTabBtn.TextSize=14;targetTabBtn.BackgroundColor3=Color3.fromRGB(50,50,50);targetTabBtn.TextColor3=THEME.text;Instance.new("UICorner",targetTabBtn).CornerRadius=UDim.new(0,8);targetTabBtn.ZIndex=12;local mainContent=Instance.new("Frame",panel);mainContent.Size=UDim2.new(1, -24,1, -140);mainContent.Position=UDim2.new(0,12,0,84);mainContent.BackgroundTransparency=1;mainContent.ZIndex=11;local targetContent=Instance.new("Frame",panel);targetContent.Size=mainContent.Size;targetContent.Position=mainContent.Position;targetContent.BackgroundTransparency=1;targetContent.ZIndex=11;targetContent.Visible=false;local customRow=Instance.new("Frame",mainContent);customRow.Size=UDim2.new(1,0,0,36);customRow.Position=UDim2.new(0,0,0,4);customRow.BackgroundTransparency=1;customRow.ZIndex=11;local customLabel=Instance.new("TextLabel",customRow);customLabel.Size=UDim2.new(0.5,0,1,0);customLabel.Position=UDim2.new(0,8,0,0);customLabel.BackgroundTransparency=1;customLabel.Text="Custom Edit";customLabel.Font=Enum.Font.SourceSans;customLabel.TextSize=14;customLabel.TextColor3=THEME.text;customLabel.TextXAlignment=Enum.TextXAlignment.Left;customLabel.ZIndex=11;local toggleBg=Instance.new("Frame",customRow);toggleBg.Size=UDim2.new(0,60,0,28);toggleBg.Position=UDim2.new(1, -72,0,4);toggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);toggleBg.ZIndex=11;local toggleKnob=Instance.new("Frame",toggleBg);toggleKnob.Size=UDim2.new(0,24,0,24);toggleKnob.Position=UDim2.new(0,2,0,2);toggleKnob.BackgroundColor3=Color3.fromRGB(235,235,235);Instance.new("UICorner",toggleBg).CornerRadius=UDim.new(0,12);Instance.new("UICorner",toggleKnob).CornerRadius=UDim.new(1,0);toggleBg.ZIndex=11;toggleKnob.ZIndex=12;local function setToggleState(on) customMode=on;if on then toggleBg.BackgroundColor3=THEME.accent;toggleKnob.Position=UDim2.new(1, -26,0,2);toggleKnob.BackgroundColor3=Color3.fromRGB(18,18,18);else toggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);toggleKnob.Position=UDim2.new(0,2,0,2);toggleKnob.BackgroundColor3=Color3.fromRGB(235,235,235);cleanupCurrentDrag();local existing=gui:FindFirstChild("ConfigMenu");if existing then existing:Destroy();end isConfigMenuOpen=false;end end setToggleState(false);toggleBg.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then setToggleState( not customMode);end end);local scroll=Instance.new("ScrollingFrame",mainContent);scroll.Size=UDim2.new(1, -12,0,200);scroll.Position=UDim2.new(0,6,0,44);scroll.BackgroundTransparency=1;scroll.ScrollBarThickness=6;scroll.ScrollBarImageColor3=THEME.soft;scroll.ZIndex=11;local panelButtonsList={{name="Grab",button=grabButton},{name="Sit",button=sitButton},{name="Drag",button=dragButton},{name="Taser",button=taserButton},{name="Launcher Grenade",button=launcherButton},{name="Auto Sit",button=autoSitFrame}};local rowHeight=44;for i,btnInfo in ipairs(panelButtonsList) do local y=(i-1) * rowHeight ;local row=Instance.new("Frame",scroll);row.Size=UDim2.new(1, -12,0,rowHeight-6 );row.Position=UDim2.new(0,6,0,y + 2 );row.BackgroundTransparency=1;row.ZIndex=11;local lbl=Instance.new("TextLabel",row);lbl.Size=UDim2.new(0.6,0,1,0);lbl.Position=UDim2.new(0,0,0,0);lbl.BackgroundTransparency=1;lbl.Font=Enum.Font.SourceSans;lbl.TextSize=14;lbl.TextXAlignment=Enum.TextXAlignment.Left;lbl.Text=btnInfo.name;lbl.TextColor3=THEME.text;lbl.ZIndex=11;local visBg=Instance.new("Frame",row);visBg.Size=UDim2.new(0,92,0,26);visBg.Position=UDim2.new(1, -100,0,6);visBg.BackgroundColor3=Color3.fromRGB(50,50,50);Instance.new("UICorner",visBg).CornerRadius=UDim.new(0,8);visBg.ZIndex=11;local visLabel=Instance.new("TextLabel",visBg);visLabel.Size=UDim2.new(1, -36,1,0);visLabel.Position=UDim2.new(0,8,0,0);visLabel.BackgroundTransparency=1;visLabel.Font=Enum.Font.SourceSansBold;visLabel.TextSize=13;visLabel.TextColor3=THEME.text;visLabel.ZIndex=12;local visBtn=Instance.new("TextButton",visBg);visBtn.Size=UDim2.new(0,28,0,24);visBtn.Position=UDim2.new(1, -32,0,1);visBtn.Text="";visBtn.AutoButtonColor=false;Instance.new("UICorner",visBtn).CornerRadius=UDim.new(0,6);visBtn.ZIndex=12;local function updateVisibilityState() if (btnInfo.button and btnInfo.button.Visible) then visLabel.Text="Visible";visBg.BackgroundColor3=THEME.success;visBtn.BackgroundColor3=Color3.fromRGB(18,18,18);else visLabel.Text="Hidden";visBg.BackgroundColor3=THEME.soft;visBtn.BackgroundColor3=Color3.fromRGB(200,200,200);end end updateVisibilityState();visBtn.MouseButton1Click:Connect(function() if  not btnInfo.button then return;end btnInfo.button.Visible= not btnInfo.button.Visible;if (btnInfo.name=="Grab") then UserSettings.grabButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Sit") then UserSettings.sitButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Auto Sit") then UserSettings.autoSitFrameVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Drag") then UserSettings.dragButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Taser") then UserSettings.taserButtonVisible=btnInfo.button.Visible;elseif (btnInfo.name=="Launcher Grenade") then UserSettings.launcherButtonVisible=btnInfo.button.Visible;end updateVisibilityState();saveSettings();end);end scroll.CanvasSize=UDim2.new(0,0,0,( #panelButtonsList * rowHeight) + 8 );local function resetConfigurationExcludingTargets() cleanupCurrentDrag();local btnSizeDefault=64;local buttonSpacing=70;local rightMargin=20;local buttonStartY=50;local leftOffset=(btnSizeDefault * 2) + rightMargin + 40 ;grabButton.Position=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY);sitButton.Position=UDim2.new(1, -leftOffset,0,buttonStartY);autoSitFrame.Position=UDim2.new(1, -leftOffset,0,buttonStartY + buttonSpacing );dragButton.Position=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + buttonSpacing );taserButton.Position=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 2) );launcherButton.Position=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 3) );grabButton.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);sitButton.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);autoSitFrame.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);dragButton.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);taserButton.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);launcherButton.Size=UDim2.new(0,btnSizeDefault,0,btnSizeDefault);defaultConfig['GrabButton']={Position=grabButton.Position,Size=grabButton.Size,Visible=true};defaultConfig['SitButton']={Position=sitButton.Position,Size=sitButton.Size,Visible=true};defaultConfig['DragButton']={Position=dragButton.Position,Size=dragButton.Size,Visible=true};defaultConfig['TaserButton']={Position=taserButton.Position,Size=taserButton.Size,Visible=true};defaultConfig['LauncherButton']={Position=launcherButton.Position,Size=launcherButton.Size,Visible=true};if buttonAnimationData[grabButton] then buttonAnimationData[grabButton].originalSize=grabButton.Size;end if buttonAnimationData[sitButton] then buttonAnimationData[sitButton].originalSize=sitButton.Size;end if buttonAnimationData[dragButton] then buttonAnimationData[dragButton].originalSize=dragButton.Size;end if buttonAnimationData[taserButton] then buttonAnimationData[taserButton].originalSize=taserButton.Size;end if buttonAnimationData[launcherButton] then buttonAnimationData[launcherButton].originalSize=launcherButton.Size;end panel.Position=UDim2.new(0,12,0.05,0);local preservedTargets={blockEnabled=UserSettings.blockEnabled,targetEnabled=UserSettings.targetEnabled,blockPlayerIds=UserSettings.blockPlayerIds or {} ,targetPlayerIds=UserSettings.targetPlayerIds or {} ,lastKnownNames=UserSettings.lastKnownNames or {} ,espEnabled=UserSettings.espEnabled};UserSettings=table.clone(DEFAULT_SETTINGS);UserSettings.blockEnabled=preservedTargets.blockEnabled;UserSettings.targetEnabled=preservedTargets.targetEnabled;UserSettings.blockPlayerIds=preservedTargets.blockPlayerIds;UserSettings.targetPlayerIds=preservedTargets.targetPlayerIds;UserSettings.lastKnownNames=preservedTargets.lastKnownNames;UserSettings.espEnabled=preservedTargets.espEnabled;autoSitEnabled=false;autoButton.BackgroundColor3=THEME.soft;autoButton.TextColor3=THEME.text;refreshBlockToggleVisual();refreshTargetToggleVisual();setEspToggleState(UserSettings.espEnabled);saveSettings();updateAllESPs();end local function showResetConfirmation() if isConfigMenuOpen then return;end local wasPanelVisible=panel.Visible;panel.Visible=false;local confirmationMenu=Instance.new("Frame",gui);confirmationMenu.Name="ResetConfirmationMenu";confirmationMenu.Size=UDim2.new(0,320,0,140);confirmationMenu.AnchorPoint=Vector2.new(0.5,0.5);confirmationMenu.Position=UDim2.new(0.5,0,0.5,0);confirmationMenu.BackgroundColor3=THEME.panelAccent;confirmationMenu.ZIndex=200;Instance.new("UICorner",confirmationMenu).CornerRadius=UDim.new(0,10);local title=Instance.new("TextLabel",confirmationMenu);title.Size=UDim2.new(1, -24,0,60);title.Position=UDim2.new(0,12,0,12);title.BackgroundTransparency=1;title.Text="Do you want to reset the configuration?";title.Font=Enum.Font.SourceSansBold;title.TextSize=16;title.TextColor3=THEME.text;title.TextWrapped=true;title.ZIndex=201;local buttonContainer=Instance.new("Frame",confirmationMenu);buttonContainer.Size=UDim2.new(1, -24,0,40);buttonContainer.Position=UDim2.new(0,12,1, -52);buttonContainer.BackgroundTransparency=1;buttonContainer.ZIndex=201;local cancelBtn=Instance.new("TextButton",buttonContainer);cancelBtn.Size=UDim2.new(0.45,0,1,0);cancelBtn.Position=UDim2.new(0,0,0,0);cancelBtn.Text="CANCEL";cancelBtn.Font=Enum.Font.SourceSansBold;cancelBtn.TextSize=14;cancelBtn.TextColor3=THEME.text;cancelBtn.BackgroundColor3=Color3.fromRGB(100,100,100);Instance.new("UICorner",cancelBtn).CornerRadius=UDim.new(0,8);cancelBtn.ZIndex=202;local resetBtn=Instance.new("TextButton",buttonContainer);resetBtn.Size=UDim2.new(0.45,0,1,0);resetBtn.Position=UDim2.new(0.55,0,0,0);resetBtn.Text="RESET";resetBtn.Font=Enum.Font.SourceSansBold;resetBtn.TextSize=14;resetBtn.TextColor3=Color3.fromRGB(255,255,255);resetBtn.BackgroundColor3=Color3.fromRGB(180,60,60);Instance.new("UICorner",resetBtn).CornerRadius=UDim.new(0,8);resetBtn.ZIndex=202;local clickOutsideConn;local function closeMenu() panel.Visible=wasPanelVisible;if (confirmationMenu and confirmationMenu.Parent) then confirmationMenu:Destroy();end if clickOutsideConn then clickOutsideConn:Disconnect();clickOutsideConn=nil;end end clickOutsideConn=UserInputService.InputBegan:Connect(function(input) if (input.UserInputType==Enum.UserInputType.MouseButton1) then local mousePos=input.Position;local menuAbsPos=confirmationMenu.AbsolutePosition;local menuAbsSize=confirmationMenu.AbsoluteSize;if ((mousePos.X<menuAbsPos.X) or (mousePos.X>(menuAbsPos.X + menuAbsSize.X)) or (mousePos.Y<menuAbsPos.Y) or (mousePos.Y>(menuAbsPos.Y + menuAbsSize.Y))) then closeMenu();end end end);cancelBtn.MouseButton1Click:Connect(function() closeMenu();end);resetBtn.MouseButton1Click:Connect(function() closeMenu();resetConfigurationExcludingTargets();end);confirmationMenu.Destroying:Connect(function() if clickOutsideConn then clickOutsideConn:Disconnect();end end);end local resetBtn=Instance.new("TextButton",panel);resetBtn.Size=UDim2.new(0,120,0,28);resetBtn.Position=UDim2.new(0,12,1, -44);resetBtn.BackgroundColor3=Color3.fromRGB(80,40,40);resetBtn.TextColor3=THEME.text;resetBtn.Font=Enum.Font.SourceSansBold;resetBtn.TextSize=14;resetBtn.Text="Reset Config";Instance.new("UICorner",resetBtn).CornerRadius=UDim.new(0,8);resetBtn.ZIndex=11;resetBtn.MouseButton1Click:Connect(function() showResetConfirmation();end);local function updateResetButtonVisibility() resetBtn.Visible=mainContent.Visible;end panelToggle.MouseButton1Click:Connect(function() panel.Visible= not panel.Visible;panelToggle.Text=(panel.Visible and "âœ•") or "â‰¡" ;UserSettings.panelVisible=panel.Visible;saveSettings();end);grabButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=grabButton.Position;if (pos and pos.X and pos.Y) then UserSettings.grabButtonPosition=udim2ToTable(pos);saveSettings();end end);sitButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=sitButton.Position;if (pos and pos.X and pos.Y) then UserSettings.sitButtonPosition=udim2ToTable(pos);saveSettings();end end);dragButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=dragButton.Position;if (pos and pos.X and pos.Y) then UserSettings.dragButtonPosition=udim2ToTable(pos);saveSettings();end end);taserButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=taserButton.Position;if (pos and pos.X and pos.Y) then UserSettings.taserButtonPosition=udim2ToTable(pos);saveSettings();end end);launcherButton:GetPropertyChangedSignal("Position"):Connect(function() local pos=launcherButton.Position;if (pos and pos.X and pos.Y) then UserSettings.launcherButtonPosition=udim2ToTable(pos);saveSettings();end end);panel:GetPropertyChangedSignal("Position"):Connect(function() local pos=panel.Position;UserSettings.panelPosition=udim2ToTable(pos);saveSettings();end);autoButton.InputBegan:Connect(function(input) if ((input.UserInputType~=Enum.UserInputType.MouseButton1) and (input.UserInputType~=Enum.UserInputType.Touch)) then return;end if customMode then pcall(function() openConfigMenu(autoSitFrame);end);return;end autoSitEnabled= not autoSitEnabled;UserSettings.autoSitEnabled=autoSitEnabled;saveSettings();if autoSitEnabled then autoButton.BackgroundColor3=THEME.success;autoButton.TextColor3=THEME.text;else autoButton.BackgroundColor3=THEME.soft;autoButton.TextColor3=THEME.text;end end);autoSitFrame.InputBegan:Connect(function(input) if (((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) and customMode) then pcall(function() openConfigMenu(autoSitFrame);end);end end);RunService.Heartbeat:Connect(function() pcall(AutoCheckImproved);end);mainTabBtn.MouseButton1Click:Connect(function() mainTabBtn.BackgroundColor3=THEME.accent;targetTabBtn.BackgroundColor3=Color3.fromRGB(50,50,50);mainContent.Visible=true;targetContent.Visible=false;updateResetButtonVisibility();end);targetTabBtn.MouseButton1Click:Connect(function() mainTabBtn.BackgroundColor3=Color3.fromRGB(50,50,50);targetTabBtn.BackgroundColor3=THEME.accent;mainContent.Visible=false;targetContent.Visible=true;updateResetButtonVisibility();end);updateResetButtonVisibility();panelToggle.Text=(panel.Visible and "âœ•") or "â‰¡" ;player.CharacterAdded:Connect(function(char) char:WaitForChild("Humanoid");HoldingManual=false;if autoSitEnabled then autoButton.BackgroundColor3=THEME.success;autoButton.TextColor3=THEME.text;else autoButton.BackgroundColor3=THEME.soft;autoButton.TextColor3=THEME.text;end end);local blockColumn=Instance.new("Frame",targetContent);blockColumn.Size=UDim2.new(0.5, -12,1, -46);blockColumn.Position=UDim2.new(0,6,0,46);blockColumn.BackgroundTransparency=1;blockColumn.ZIndex=11;local targetColumn=Instance.new("Frame",targetContent);targetColumn.Size=UDim2.new(0.5, -12,1, -46);targetColumn.Position=UDim2.new(0.5,12,0,46);targetColumn.BackgroundTransparency=1;targetColumn.ZIndex=11;local blockTitleRow=Instance.new("Frame",blockColumn);blockTitleRow.Size=UDim2.new(1,0,0,28);blockTitleRow.Position=UDim2.new(0,0,0,0);blockTitleRow.BackgroundTransparency=1;local blockTitle=Instance.new("TextLabel",blockTitleRow);blockTitle.Size=UDim2.new(0.65,0,1,0);blockTitle.BackgroundTransparency=1;blockTitle.Font=Enum.Font.SourceSansBold;blockTitle.TextSize=14;blockTitle.TextColor3=THEME.text;blockTitle.Text="Block Player";blockTitle.TextXAlignment=Enum.TextXAlignment.Left;local blockToggle=Instance.new("TextButton",blockTitleRow);blockToggle.Size=UDim2.new(0.33,0,0.9,0);blockToggle.Position=UDim2.new(0.66,0,0.05,0);blockToggle.Font=Enum.Font.SourceSansBold;blockToggle.TextSize=13;blockToggle.TextColor3=THEME.text;Instance.new("UICorner",blockToggle).CornerRadius=UDim.new(0,6);blockToggle.ZIndex=21;local function refreshBlockToggleVisual() if UserSettings.blockEnabled then blockToggle.Text="Block: ON";blockToggle.BackgroundColor3=THEME.success;else blockToggle.Text="Block: OFF";blockToggle.BackgroundColor3=THEME.muted;end end if (type(UserSettings.blockEnabled)~="boolean") then UserSettings.blockEnabled=true;end refreshBlockToggleVisual();local blockInputRow=Instance.new("Frame",blockColumn);blockInputRow.Size=UDim2.new(1,0,0,32);blockInputRow.Position=UDim2.new(0,0,0,36);blockInputRow.BackgroundTransparency=1;local blockTextBox=Instance.new("TextBox",blockInputRow);blockTextBox.Size=UDim2.new(0.7,0,1,0);blockTextBox.Position=UDim2.new(0,0,0,0);blockTextBox.Text="";blockTextBox.PlaceholderText="";blockTextBox.ClearTextOnFocus=false;blockTextBox.Font=Enum.Font.SourceSans;blockTextBox.TextSize=14;blockTextBox.TextColor3=THEME.text;blockTextBox.BackgroundColor3=Color3.fromRGB(40,40,40);Instance.new("UICorner",blockTextBox).CornerRadius=UDim.new(0,6);blockTextBox.ZIndex=21;local blockAddBtn=Instance.new("TextButton",blockInputRow);blockAddBtn.Size=UDim2.new(0.28,0,1,0);blockAddBtn.Position=UDim2.new(0.72,8,0,0);blockAddBtn.Text="Add";blockAddBtn.Font=Enum.Font.SourceSansBold;blockAddBtn.TextSize=14;blockAddBtn.TextColor3=THEME.text;blockAddBtn.BackgroundColor3=THEME.accent;Instance.new("UICorner",blockAddBtn).CornerRadius=UDim.new(0,6);blockAddBtn.ZIndex=21;local blockListFrameBg=Instance.new("Frame",blockColumn);blockListFrameBg.Size=UDim2.new(1,0,0,140);blockListFrameBg.Position=UDim2.new(0,0,0,72);blockListFrameBg.BackgroundColor3=Color3.fromRGB(28,32,36);Instance.new("UICorner",blockListFrameBg).CornerRadius=UDim.new(0,8);blockListFrameBg.ZIndex=19;local blockListFrame=Instance.new("ScrollingFrame",blockListFrameBg);blockListFrame.Size=UDim2.new(1, -12,1, -12);blockListFrame.Position=UDim2.new(0,6,0,6);blockListFrame.BackgroundTransparency=1;blockListFrame.ScrollBarThickness=6;blockListFrame.ZIndex=20;blockListFrame.CanvasSize=UDim2.new(0,0,0,0);local targetTitleRow=Instance.new("Frame",targetColumn);targetTitleRow.Size=UDim2.new(1,0,0,28);targetTitleRow.Position=UDim2.new(0,0,0,0);targetTitleRow.BackgroundTransparency=1;local targetTitle=Instance.new("TextLabel",targetTitleRow);targetTitle.Size=UDim2.new(0.65,0,1,0);targetTitle.BackgroundTransparency=1;targetTitle.Font=Enum.Font.SourceSansBold;targetTitle.TextSize=14;targetTitle.TextColor3=THEME.text;targetTitle.Text="Target Player";targetTitle.TextXAlignment=Enum.TextXAlignment.Left;local targetToggle=Instance.new("TextButton",targetTitleRow);targetToggle.Size=UDim2.new(0.33,0,0.9,0);targetToggle.Position=UDim2.new(0.66,0,0.05,0);targetToggle.Font=Enum.Font.SourceSansBold;targetToggle.TextSize=13;targetToggle.TextColor3=THEME.text;Instance.new("UICorner",targetToggle).CornerRadius=UDim.new(0,6);targetToggle.ZIndex=21;local function refreshTargetToggleVisual() if UserSettings.targetEnabled then targetToggle.Text="Target: ON";targetToggle.BackgroundColor3=THEME.success;else targetToggle.Text="Target: OFF";targetToggle.BackgroundColor3=THEME.muted;end end if (type(UserSettings.targetEnabled)~="boolean") then UserSettings.targetEnabled=true;end refreshTargetToggleVisual();local targetInputRow=Instance.new("Frame",targetColumn);targetInputRow.Size=UDim2.new(1,0,0,32);targetInputRow.Position=UDim2.new(0,0,0,36);targetInputRow.BackgroundTransparency=1;local targetTextBox=Instance.new("TextBox",targetInputRow);targetTextBox.Size=UDim2.new(0.7,0,1,0);targetTextBox.Position=UDim2.new(0,0,0,0);targetTextBox.Text="";targetTextBox.PlaceholderText="";targetTextBox.ClearTextOnFocus=false;targetTextBox.Font=Enum.Font.SourceSans;targetTextBox.TextSize=14;targetTextBox.TextColor3=THEME.text;targetTextBox.BackgroundColor3=Color3.fromRGB(40,40,40);Instance.new("UICorner",targetTextBox).CornerRadius=UDim.new(0,6);targetTextBox.ZIndex=21;local targetAddBtn=Instance.new("TextButton",targetInputRow);targetAddBtn.Size=UDim2.new(0.28,0,1,0);targetAddBtn.Position=UDim2.new(0.72,8,0,0);targetAddBtn.Text="Add";targetAddBtn.Font=Enum.Font.SourceSansBold;targetAddBtn.TextSize=14;targetAddBtn.TextColor3=THEME.text;targetAddBtn.BackgroundColor3=THEME.accent;Instance.new("UICorner",targetAddBtn).CornerRadius=UDim.new(0,6);targetAddBtn.ZIndex=21;local targetListFrameBg=Instance.new("Frame",targetColumn);targetListFrameBg.Size=UDim2.new(1,0,0,140);targetListFrameBg.Position=UDim2.new(0,0,0,72);targetListFrameBg.BackgroundColor3=Color3.fromRGB(28,32,36);Instance.new("UICorner",targetListFrameBg).CornerRadius=UDim.new(0,8);targetListFrameBg.ZIndex=19;local targetListFrame=Instance.new("ScrollingFrame",targetListFrameBg);targetListFrame.Size=UDim2.new(1, -12,1, -12);targetListFrame.Position=UDim2.new(0,6,0,6);targetListFrame.BackgroundTransparency=1;targetListFrame.ScrollBarThickness=6;targetListFrame.ZIndex=20;targetListFrame.CanvasSize=UDim2.new(0,0,0,0);local uiEntries={};local function reflowSorted(frame,listType) local entries={};for uid,data in pairs(uiEntries) do if (data.listType==listType) then table.insert(entries,{frame=data.frame,online=data.online,id=uid});end end table.sort(entries,function(a,b) if (a.online~=b.online) then return a.online;end return tostring(a.id)<tostring(b.id) ;end);local idx=0;for _,entry in ipairs(entries) do entry.frame.Position=UDim2.new(0,4,0,idx * 34 );idx=idx + 1 ;end frame.CanvasSize=UDim2.new(0,0,0,idx * 34 );end local function getDisplayForId(id,p) if p then if (p.DisplayName and (p.DisplayName~="") and (p.DisplayName~=p.Name)) then return tostring(p.DisplayName);else return tostring(p.Name);end else if lastKnownNames[id] then return lastKnownNames[id];end return "UserId:"   .. tostring(id) ;end end local esps={};local function createBillboardForCharacter(character,text,color) if  not character then return nil;end local head=character:FindFirstChild("Head") or character:FindFirstChild("HumanoidRootPart") ;if  not head then return nil;end for _,child in ipairs(head:GetChildren()) do if (child:IsA("BillboardGui") and (child.Name=="NexESP_Billboard")) then child:Destroy();end end local billboard=Instance.new("BillboardGui");billboard.Name="NexESP_Billboard";billboard.Size=UDim2.new(0,200,0,32);billboard.StudsOffset=Vector3.new(0,2.5,0);billboard.AlwaysOnTop=true;billboard.MaxDistance=1000;billboard.Adornee=head;billboard.Parent=head;local label=Instance.new("TextLabel",billboard);label.Size=UDim2.new(1,0,1,0);label.BackgroundTransparency=1;label.Font=Enum.Font.SourceSansBold;label.TextSize=16;label.TextScaled=false;label.Text=text or "" ;label.TextColor3=color or Color3.new(1,1,1) ;label.TextStrokeTransparency=0.6;label.ZIndex=1000;return billboard;end local function createHighlightForCharacter(character,color) if  not character then return nil;end for _,child in ipairs(character:GetChildren()) do if (child:IsA("Highlight") and (child.Name=="NexESP_Highlight")) then child:Destroy();end end local highlight=Instance.new("Highlight");highlight.Name="NexESP_Highlight";highlight.Adornee=character;highlight.FillColor=color;highlight.FillTransparency=0.4;highlight.OutlineTransparency=1;highlight.Parent=character;return highlight;end local function addESP(p,col) if esps[p] then removeESP(p);end if ( not p or  not p.Parent) then return;end local function setupESP(character) if  not character then return;end local billboard=createBillboardForCharacter(character,p.DisplayName or p.Name ,col);local highlight=createHighlightForCharacter(character,col);if ( not billboard or  not highlight) then return;end esps[p]={billboard=billboard,highlight=highlight,character=character,color=col,characterConn=nil};end if p.Character then setupESP(p.Character);end local conn=p.CharacterAdded:Connect(function(char) if esps[p] then wait(0.3);setupESP(char);end end);if  not esps[p] then esps[p]={characterConn=conn,color=col};else esps[p].characterConn=conn;end end local function removeESP(p) local e=esps[p];if e then if e.billboard then pcall(function() e.billboard:Destroy();end);end if e.highlight then pcall(function() e.highlight:Destroy();end);end if e.characterConn then pcall(function() e.characterConn:Disconnect();end);end esps[p]=nil;end end local function updateAllESPs() for player in pairs(esps) do if ( not player or  not player.Parent) then removeESP(player);end end local shouldHaveESP={};if UserSettings.espEnabled then for _,player in ipairs(Players:GetPlayers()) do if (player~=LocalPlayer) then local id=player.UserId;if (blockPlayerSet[id] and UserSettings.blockEnabled) then shouldHaveESP[player]=Color3.fromRGB(0,150,0);elseif (targetPlayerSet[id] and UserSettings.targetEnabled) then shouldHaveESP[player]=Color3.fromRGB(150,0,0);end end end end for player,espData in pairs(esps) do if  not shouldHaveESP[player] then removeESP(player);elseif shouldHaveESP[player] then local expectedColor=shouldHaveESP[player];local currentColor=espData.color;if (currentColor~=expectedColor) then removeESP(player);addESP(player,expectedColor);elseif (espData.billboard and ( not espData.billboard.Parent or (espData.billboard.Parent.Parent~=player.Character))) then removeESP(player);addESP(player,expectedColor);end end end for player,color in pairs(shouldHaveESP) do if  not esps[player] then addESP(player,color);end end end local function createOrUpdateEntry(id,listType,p) id=tonumber(id);if  not id then return;end local listFrame=((listType=="block") and blockListFrame) or targetListFrame ;if (uiEntries[id] and (uiEntries[id].listType~=listType)) then pcall(function() uiEntries[id].frame:Destroy();end);uiEntries[id]=nil;end if  not uiEntries[id] then local entryFrame=Instance.new("Frame",listFrame);entryFrame.Size=UDim2.new(1, -8,0,30);entryFrame.BackgroundTransparency=0;entryFrame.BackgroundColor3=Color3.fromRGB(0,0,0);entryFrame.BorderSizePixel=0;entryFrame.ZIndex=25;Instance.new("UICorner",entryFrame).CornerRadius=UDim.new(0,6);local nameLabel=Instance.new("TextLabel",entryFrame);nameLabel.Size=UDim2.new(1, -40,1,0);nameLabel.Position=UDim2.new(0,8,0,0);nameLabel.BackgroundTransparency=1;nameLabel.Font=Enum.Font.SourceSans;nameLabel.TextSize=14;nameLabel.TextXAlignment=Enum.TextXAlignment.Left;nameLabel.TextColor3=THEME.text;nameLabel.ZIndex=26;local remBtn=Instance.new("TextButton",entryFrame);remBtn.Size=UDim2.new(0,28,0,22);remBtn.Position=UDim2.new(1, -36,0,4);remBtn.Text="X";remBtn.Font=Enum.Font.SourceSansBold;remBtn.TextSize=14;remBtn.TextColor3=THEME.text;remBtn.BackgroundColor3=Color3.fromRGB(160,40,40);remBtn.AutoButtonColor=false;Instance.new("UICorner",remBtn).CornerRadius=UDim.new(0,6);remBtn.ZIndex=26;uiEntries[id]={frame=entryFrame,label=nameLabel,online=false,listType=listType};remBtn.MouseButton1Click:Connect(function() if uiEntries[id] then local lt=uiEntries[id].listType;if (lt=="block") then blockPlayerSet[id]=nil;for i= #blockPlayerIds,1, -1 do if (blockPlayerIds[i]==id) then table.remove(blockPlayerIds,i);end end else targetPlayerSet[id]=nil;for i= #targetPlayerIds,1, -1 do if (targetPlayerIds[i]==id) then table.remove(targetPlayerIds,i);end end end pcall(function() uiEntries[id].frame:Destroy();end);uiEntries[id]=nil;persistLists();updateAllESPs();if (lt=="block") then reflowSorted(blockListFrame,"block");else reflowSorted(targetListFrame,"target");end end end);end local entry=uiEntries[id];if  not entry then return;end entry.listType=listType;entry.label.Text=getDisplayForId(id,p);local wasOnline=entry.online;entry.online=p~=nil ;if entry.online then entry.label.TextColor3=THEME.success;entry.frame.BackgroundTransparency=0.03;else entry.label.TextColor3=THEME.muted;entry.frame.BackgroundTransparency=0;entry.frame.BackgroundColor3=Color3.fromRGB(22,22,22);end if p then lastKnownNames[id]=getDisplayForId(id,p);UserSettings.lastKnownNames=lastKnownNames;saveSettings();end if (wasOnline~=entry.online) then reflowSorted(blockListFrame,"block");reflowSorted(targetListFrame,"target");end end local function addPlayerByInputToList(inputText,listType) if ( not inputText or (inputText=="")) then return false;end local maybeId=tonumber(inputText);if maybeId then local foundPlayer=nil;for _,p in ipairs(Players:GetPlayers()) do if (p.UserId==maybeId) then foundPlayer=p;break;end end if (listType=="block") then if targetPlayerSet[maybeId] then targetPlayerSet[maybeId]=nil;for i= #targetPlayerIds,1, -1 do if (targetPlayerIds[i]==maybeId) then table.remove(targetPlayerIds,i);end end if (uiEntries[maybeId] and (uiEntries[maybeId].listType=="target")) then pcall(function() uiEntries[maybeId].frame:Destroy();end);uiEntries[maybeId]=nil;end end if blockPlayerSet[maybeId] then return true;end blockPlayerSet[maybeId]=true;table.insert(blockPlayerIds,maybeId);else if blockPlayerSet[maybeId] then blockPlayerSet[maybeId]=nil;for i= #blockPlayerIds,1, -1 do if (blockPlayerIds[i]==maybeId) then table.remove(blockPlayerIds,i);end end if (uiEntries[maybeId] and (uiEntries[maybeId].listType=="block")) then pcall(function() uiEntries[maybeId].frame:Destroy();end);uiEntries[maybeId]=nil;end end if targetPlayerSet[maybeId] then return true;end targetPlayerSet[maybeId]=true;table.insert(targetPlayerIds,maybeId);end if foundPlayer then createOrUpdateEntry(maybeId,listType,foundPlayer);lastKnownNames[maybeId]=getDisplayForId(maybeId,foundPlayer);else createOrUpdateEntry(maybeId,listType,nil);end persistLists();updateAllESPs();reflowSorted(blockListFrame,"block");reflowSorted(targetListFrame,"target");return true;end local found=nil;for _,p in ipairs(Players:GetPlayers()) do if ((p~=LocalPlayer) and matchNameInput(inputText,p)) then found=p;break;end end if  not found then return false;end local id=found.UserId;if (listType=="block") then if targetPlayerSet[id] then targetPlayerSet[id]=nil;for i= #targetPlayerIds,1, -1 do if (targetPlayerIds[i]==id) then table.remove(targetPlayerIds,i);end end if (uiEntries[id] and (uiEntries[id].listType=="target")) then pcall(function() uiEntries[id].frame:Destroy();end);uiEntries[id]=nil;end end if blockPlayerSet[id] then return true;end blockPlayerSet[id]=true;table.insert(blockPlayerIds,id);else if blockPlayerSet[id] then blockPlayerSet[id]=nil;for i= #blockPlayerIds,1, -1 do if (blockPlayerIds[i]==id) then table.remove(blockPlayerIds,i);end end if (uiEntries[id] and (uiEntries[id].listType=="block")) then pcall(function() uiEntries[id].frame:Destroy();end);uiEntries[id]=nil;end end if targetPlayerSet[id] then return true;end targetPlayerSet[id]=true;table.insert(targetPlayerIds,id);end createOrUpdateEntry(id,listType,found);lastKnownNames[id]=getDisplayForId(id,found);persistLists();updateAllESPs();reflowSorted(blockListFrame,"block");reflowSorted(targetListFrame,"target");return true;end blockAddBtn.MouseButton1Click:Connect(function() local txt=blockTextBox.Text;if addPlayerByInputToList(txt,"block") then blockTextBox.Text="";else spawn(function() local orig=blockTextBox.BackgroundColor3;blockTextBox.BackgroundColor3=Color3.fromRGB(120,40,40);wait(0.25);blockTextBox.BackgroundColor3=orig;end);end end);targetAddBtn.MouseButton1Click:Connect(function() local txt=targetTextBox.Text;if addPlayerByInputToList(txt,"target") then targetTextBox.Text="";else spawn(function() local orig=targetTextBox.BackgroundColor3;targetTextBox.BackgroundColor3=Color3.fromRGB(120,40,40);wait(0.25);targetTextBox.BackgroundColor3=orig;end);end end);for _,id in ipairs(blockPlayerIds) do local onlinePlayer=nil;for _,p in ipairs(Players:GetPlayers()) do if (p.UserId==id) then onlinePlayer=p;break;end end createOrUpdateEntry(id,"block",onlinePlayer);end for _,id in ipairs(targetPlayerIds) do local onlinePlayer=nil;for _,p in ipairs(Players:GetPlayers()) do if (p.UserId==id) then onlinePlayer=p;break;end end createOrUpdateEntry(id,"target",onlinePlayer);end Players.PlayerAdded:Connect(function(p) local id=p.UserId;lastKnownNames[id]=getDisplayForId(id,p);UserSettings.lastKnownNames=lastKnownNames;saveSettings();if (blockPlayerSet[id] or targetPlayerSet[id]) then createOrUpdateEntry(id,(blockPlayerSet[id] and "block") or (targetPlayerSet[id] and "target") ,p);updateAllESPs();end end);Players.PlayerRemoving:Connect(function(p) local id=p.UserId;if uiEntries[id] then createOrUpdateEntry(id,uiEntries[id].listType,nil);end removeESP(p);end);local function isAllowedTarget(p) if  not p then return true;end local id=p.UserId;if (UserSettings.targetEnabled and ( #targetPlayerIds>0)) then return targetPlayerSet[id]==true ;end if (UserSettings.blockEnabled and ( #blockPlayerIds>0)) then return  not (blockPlayerSet[id]==true);end return true;end local espRow=Instance.new("Frame",targetContent);espRow.Size=UDim2.new(1, -24,0,36);espRow.Position=UDim2.new(0,12,0,4);espRow.BackgroundTransparency=1;espRow.ZIndex=11;local espLabel=Instance.new("TextLabel",espRow);espLabel.Size=UDim2.new(0.5,0,1,0);espLabel.Position=UDim2.new(0,8,0,0);espLabel.BackgroundTransparency=1;espLabel.Text="Enable ESP";espLabel.Font=Enum.Font.SourceSans;espLabel.TextSize=14;espLabel.TextColor3=THEME.text;espLabel.TextXAlignment=Enum.TextXAlignment.Left;espLabel.ZIndex=11;local espToggleBg=Instance.new("Frame",espRow);espToggleBg.Size=UDim2.new(0,60,0,28);espToggleBg.Position=UDim2.new(1, -72,0,4);espToggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);espToggleBg.ZIndex=11;Instance.new("UICorner",espToggleBg).CornerRadius=UDim.new(0,12);local espKnob=Instance.new("Frame",espToggleBg);espKnob.Size=UDim2.new(0,24,0,24);espKnob.Position=UDim2.new(0,2,0,2);espKnob.BackgroundColor3=Color3.fromRGB(235,235,235);Instance.new("UICorner",espKnob).CornerRadius=UDim.new(1,0);espKnob.ZIndex=12;local function setEspToggleState(on) UserSettings.espEnabled=on;if on then espToggleBg.BackgroundColor3=THEME.accent;espKnob.Position=UDim2.new(1, -26,0,2);espKnob.BackgroundColor3=Color3.fromRGB(18,18,18);updateAllESPs();else espToggleBg.BackgroundColor3=Color3.fromRGB(50,55,58);espKnob.Position=UDim2.new(0,2,0,2);espKnob.BackgroundColor3=Color3.fromRGB(235,235,235);for player in pairs(esps) do removeESP(player);end end saveSettings();end setEspToggleState(UserSettings.espEnabled);espToggleBg.InputBegan:Connect(function(input) if ((input.UserInputType==Enum.UserInputType.MouseButton1) or (input.UserInputType==Enum.UserInputType.Touch)) then setEspToggleState( not UserSettings.espEnabled);end end);blockToggle.MouseButton1Click:Connect(function() UserSettings.blockEnabled= not UserSettings.blockEnabled;refreshBlockToggleVisual();saveSettings();updateAllESPs();end);targetToggle.MouseButton1Click:Connect(function() UserSettings.targetEnabled= not UserSettings.targetEnabled;refreshTargetToggleVisual();saveSettings();updateAllESPs();end);local isProcessingTaser=false;local function setupTaserButton() taserButton.MouseButton1Click:Connect(function() if customMode then openConfigMenu(taserButton);return;end if isProcessingTaser then return;end isProcessingTaser=true;EquipTool("Taser");local targetPlayer=nil;if (UserSettings.targetEnabled and ( #targetPlayerIds>0)) then targetPlayer=GetClosestPlayerWithinRange(25);else targetPlayer=GetPlayerLookingAt(25);if  not targetPlayer then targetPlayer=GetClosestPlayerWithinRange(25);end end if (targetPlayer and targetPlayer.Character and isAllowedTarget(targetPlayer)) then highlightPlayer(targetPlayer.Character);ExecuteAction("Taser",targetPlayer.Character.Head,targetPlayer.Character.HumanoidRootPart.Position,targetPlayer.Character.HumanoidRootPart.CFrame);end isProcessingTaser=false;end);end local isProcessingLauncher=false;local function setupLauncherGrenadeButton() launcherButton.MouseButton1Click:Connect(function() if customMode then openConfigMenu(launcherButton);return;end if isProcessingLauncher then return;end isProcessingLauncher=true;EquipTool("Grenade Launcher");local targetPlayer=nil;if (UserSettings.targetEnabled and ( #targetPlayerIds>0)) then local closestTargetPlayer=nil;local closestDistance=math.huge;for _,player in ipairs(Players:GetPlayers()) do if ((player~=LocalPlayer) and targetPlayerSet[player.UserId]) then local character=player.Character;if (character and character:FindFirstChild("HumanoidRootPart")) then local localCharacter=LocalPlayer.Character;if (localCharacter and localCharacter:FindFirstChild("HumanoidRootPart")) then local distance=(character.HumanoidRootPart.Position-localCharacter.HumanoidRootPart.Position).Magnitude;if (distance<closestDistance) then closestDistance=distance;closestTargetPlayer=player;end end end end end targetPlayer=closestTargetPlayer;else targetPlayer=GetPlayerAtScreenCenter();end if (targetPlayer and targetPlayer.Character and isAllowedTarget(targetPlayer)) then highlightPlayer(targetPlayer.Character);local localCharacter=LocalPlayer.Character;if ( not localCharacter or  not localCharacter:FindFirstChild("HumanoidRootPart")) then isProcessingLauncher=false;return;end local startPos=localCharacter.HumanoidRootPart.Position;local targetCharacter=targetPlayer.Character;local targetPos=targetCharacter.HumanoidRootPart.Position;local targetVelocity=targetCharacter.HumanoidRootPart.Velocity;local finalTargetPos,finalCFrame=CalculateGrenadeTrajectory(startPos,targetPos,targetVelocity);local args={[1]=targetCharacter.Head,[2]="Grenade Launcher",[3]=finalTargetPos,[4]=finalCFrame};if (ReplicatedStorage:FindFirstChild("Events") and ReplicatedStorage.Events:FindFirstChild("Grab")) then ReplicatedStorage.Events.Grab:FireServer(unpack(args));end end isProcessingLauncher=false;end);end local isProcessingGrab=false;local function setupGrabButton() grabButton.MouseButton1Click:Connect(function() if customMode then openConfigMenu(grabButton);return;end if isProcessingGrab then return;end isProcessingGrab=true;EquipTool("Grab");local closestPlayer=GetClosestPlayer();if (closestPlayer and closestPlayer.Character) then if  not isAllowedTarget(closestPlayer) then isProcessingGrab=false;return;end highlightPlayer(closestPlayer.Character);local args={[1]=closestPlayer.Character.HumanoidRootPart,[2]="Grab",[3]=Vector3.new(0,0,0),[4]=CFrame.new()};ExecuteAction("Grab",unpack(args));end isProcessingGrab=false;end);end local isProcessingDrag=false;local function setupDragButton() dragButton.MouseButton1Click:Connect(function() if customMode then openConfigMenu(dragButton);return;end if isProcessingDrag then return;end isProcessingDrag=true;EquipTool("Drag");local closestPlayer=GetClosestPlayer();if (closestPlayer and closestPlayer.Character) then if  not isAllowedTarget(closestPlayer) then isProcessingDrag=false;return;end highlightPlayer(closestPlayer.Character);ExecuteAction("Drag",closestPlayer.Character.HumanoidRootPart,closestPlayer.Character.HumanoidRootPart.Position,closestPlayer.Character.HumanoidRootPart.CFrame);end isProcessingDrag=false;end);end local function setupSitButton() sitButton.MouseButton1Click:Connect(function() if customMode then openConfigMenu(sitButton);return;end local humanoid=player.Character and player.Character:FindFirstChild("Humanoid") ;if humanoid then humanoid.Sit=true;end end);end setupGrabButton();setupDragButton();setupTaserButton();setupLauncherGrenadeButton();setupSitButton();do local defaultGrabPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY);local defaultSitPos=UDim2.new(1, -leftOffset,0,buttonStartY);local defaultAutoPos=UDim2.new(1, -leftOffset,0,buttonStartY + buttonSpacing );local defaultDragPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + buttonSpacing );local defaultTaserPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 2) );local defaultLauncherPos=UDim2.new(1, -(btnSizeDefault + rightMargin),0,buttonStartY + (buttonSpacing * 3) );if (UserSettings.grabButtonVisible~=nil) then grabButton.Visible=UserSettings.grabButtonVisible;end if (UserSettings.sitButtonVisible~=nil) then sitButton.Visible=UserSettings.sitButtonVisible;end if (UserSettings.autoSitFrameVisible~=nil) then autoSitFrame.Visible=UserSettings.autoSitFrameVisible;end if (UserSettings.dragButtonVisible~=nil) then dragButton.Visible=UserSettings.dragButtonVisible;end if (UserSettings.taserButtonVisible~=nil) then taserButton.Visible=UserSettings.taserButtonVisible;end if (UserSettings.launcherButtonVisible~=nil) then launcherButton.Visible=UserSettings.launcherButtonVisible;end if (UserSettings.grabButtonPosition and ( #UserSettings.grabButtonPosition==4)) then grabButton.Position=tableToUDim2(UserSettings.grabButtonPosition,defaultGrabPos);else grabButton.Position=defaultGrabPos;end if (UserSettings.sitButtonPosition and ( #UserSettings.sitButtonPosition==4)) then sitButton.Position=tableToUDim2(UserSettings.sitButtonPosition,defaultSitPos);else sitButton.Position=defaultSitPos;end if (UserSettings.autoSitFramePosition and ( #UserSettings.autoSitFramePosition==4)) then autoSitFrame.Position=tableToUDim2(UserSettings.autoSitFramePosition,defaultAutoPos);else autoSitFrame.Position=defaultAutoPos;end if (UserSettings.dragButtonPosition and ( #UserSettings.dragButtonPosition==4)) then dragButton.Position=tableToUDim2(UserSettings.dragButtonPosition,defaultDragPos);else dragButton.Position=defaultDragPos;end if (UserSettings.taserButtonPosition and ( #UserSettings.taserButtonPosition==4)) then taserButton.Position=tableToUDim2(UserSettings.taserButtonPosition,defaultTaserPos);else taserButton.Position=defaultTaserPos;end if (UserSettings.launcherButtonPosition and ( #UserSettings.launcherButtonPosition==4)) then launcherButton.Position=tableToUDim2(UserSettings.launcherButtonPosition,defaultLauncherPos);else launcherButton.Position=defaultLauncherPos;end if (UserSettings.grabButtonSize and ( #UserSettings.grabButtonSize==1)) then grabButton.Size=UDim2.new(0,UserSettings.grabButtonSize[1],0,UserSettings.grabButtonSize[1]);if defaultConfig['GrabButton'] then defaultConfig['GrabButton'].Size=UDim2.new(0,UserSettings.grabButtonSize[1],0,UserSettings.grabButtonSize[1]);end if buttonAnimationData[grabButton] then buttonAnimationData[grabButton].originalSize=grabButton.Size;end end if (UserSettings.sitButtonSize and ( #UserSettings.sitButtonSize==1)) then sitButton.Size=UDim2.new(0,UserSettings.sitButtonSize[1],0,UserSettings.sitButtonSize[1]);if defaultConfig['SitButton'] then defaultConfig['SitButton'].Size=UDim2.new(0,UserSettings.sitButtonSize[1],0,UserSettings.sitButtonSize[1]);end if buttonAnimationData[sitButton] then buttonAnimationData[sitButton].originalSize=sitButton.Size;end end if (UserSettings.autoSitFrameSize and ( #UserSettings.autoSitFrameSize==1)) then autoSitFrame.Size=UDim2.new(0,UserSettings.autoSitFrameSize[1],0,UserSettings.autoSitFrameSize[1]);end if (UserSettings.dragButtonSize and ( #UserSettings.dragButtonSize==1)) then dragButton.Size=UDim2.new(0,UserSettings.dragButtonSize[1],0,UserSettings.dragButtonSize[1]);if defaultConfig['DragButton'] then defaultConfig['DragButton'].Size=UDim2.new(0,UserSettings.dragButtonSize[1],0,UserSettings.dragButtonSize[1]);end if buttonAnimationData[dragButton] then buttonAnimationData[dragButton].originalSize=dragButton.Size;end end if (UserSettings.taserButtonSize and ( #UserSettings.taserButtonSize==1)) then taserButton.Size=UDim2.new(0,UserSettings.taserButtonSize[1],0,UserSettings.taserButtonSize[1]);if defaultConfig['TaserButton'] then defaultConfig['TaserButton'].Size=UDim2.new(0,UserSettings.taserButtonSize[1],0,UserSettings.taserButtonSize[1]);end if buttonAnimationData[taserButton] then buttonAnimationData[taserButton].originalSize=taserButton.Size;end end if (UserSettings.launcherButtonSize and ( #UserSettings.launcherButtonSize==1)) then launcherButton.Size=UDim2.new(0,UserSettings.launcherButtonSize[1],0,UserSettings.launcherButtonSize[1]);if defaultConfig['LauncherButton'] then defaultConfig['LauncherButton'].Size=UDim2.new(0,UserSettings.launcherButtonSize[1],0,UserSettings.launcherButtonSize[1]);end if buttonAnimationData[launcherButton] then buttonAnimationData[launcherButton].originalSize=launcherButton.Size;end end end if autoSitEnabled then autoButton.BackgroundColor3=THEME.success;autoButton.TextColor3=THEME.text;else autoButton.BackgroundColor3=THEME.soft;autoButton.TextColor3=THEME.text;end refreshBlockToggleVisual();refreshTargetToggleVisual();if UserSettings.espEnabled then spawn(function() wait(0.2);updateAllESPs();end);end local respondedCooldown={};local allowedUserIds={[876957480]=true,[10333582802]=true,[2776567124]=true,[8279785613]=true,[7462933054]=true};local function trySendToExistingChannels(msg,target) if ( not TextChatService or  not TextChatService.TextChannels) then return false,nil;end local targetLower=((type(target)=="string") and string.lower(target)) or ((type(target)=="table") and tostring(target.UserId)) or "" ;for _,ch in ipairs(TextChatService.TextChannels:GetChildren()) do if (ch and (typeof(ch.SendAsync)=="function")) then local cname=tostring(ch.Name or "" ):lower();if (((targetLower~="") and (string.find(cname,targetLower) or string.find(cname,"whisper"))) or ((tostring(target.UserId or "" )~="") and string.find(cname,tostring(target.UserId)))) then local ok=pcall(function() ch:SendAsync(msg);end);if ok then return true,ch;end end end end return false,nil;end local function trySayMessageRequest(msg) local events=ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents");if  not events then return false;end local say=events:FindFirstChild("SayMessageRequest");if (say and (typeof(say.FireServer)=="function")) then local ok=pcall(function() say:FireServer(msg,"All");end);return ok;end return false;end local function attemptOpenWhisperOnce(targetString) if ( not targetString or (targetString=="")) then return false;end local prefixes={"/w ","/whisper ","/pm ","/tell "};local quotes={"",'\"',"'"};for _,pfx in ipairs(prefixes) do for _,q in ipairs(quotes) do local cand=pfx   .. (((q~="") and (q   .. targetString   .. q)) or targetString)   .. " " ;local sent=false;if (TextChatService and TextChatService.TextChannels) then for _,ch in ipairs(TextChatService.TextChannels:GetChildren()) do if (ch and (typeof(ch.SendAsync)=="function")) then local ok=pcall(function() ch:SendAsync(cand);end);if ok then sent=true;break;end end end end if  not sent then pcall(function() trySayMessageRequest(cand);end);end return true;end end return false;end local function findPrivateChannelForTarget(target) pcall(function() if (TextChatService and TextChatService.ChatInputBarConfiguration) then local bar=TextChatService.ChatInputBarConfiguration;if (bar and bar.TargetTextChannel and (typeof(bar.TargetTextChannel.SendAsync)=="function")) then return bar.TargetTextChannel;end end end);if (TextChatService and TextChatService.TextChannels) then local tlower=((type(target)=="string") and string.lower(target)) or (target and target.UserId and tostring(target.UserId)) or "" ;for _,ch in ipairs(TextChatService.TextChannels:GetChildren()) do local cname=tostring(ch.Name or "" ):lower();if (((tlower~="") and (string.find(cname,tlower) or string.find(cname,"whisper"))) or ((tostring(target.UserId or "" )~="") and string.find(cname,tostring(target.UserId)))) then if (typeof(ch.SendAsync)=="function") then return ch;end end end end return nil;end local function sendNsitToTargetOnce(targetPlayerOrName) local targetStr=nil;if ((typeof(targetPlayerOrName)=="Instance") and targetPlayerOrName.Name) then targetStr=targetPlayerOrName.Name;elseif (type(targetPlayerOrName)=="string") then targetStr=targetPlayerOrName;elseif ((type(targetPlayerOrName)=="table") and targetPlayerOrName.UserId) then targetStr=targetPlayerOrName.Name;end local ok,ch=pcall(function() return trySendToExistingChannels("nsit",targetPlayerOrName);end);if (ok and ch) then return true;end local opened=attemptOpenWhisperOnce(targetStr or tostring(targetPlayerOrName) );if  not opened then return false;end task.wait(0.22);local privateCh=findPrivateChannelForTarget(targetPlayerOrName);if (privateCh and (typeof(privateCh.SendAsync)=="function")) then local s=pcall(function() privateCh:SendAsync("nsit");end);if s then return true;end end local finalCmd="/w "   .. (targetStr or "")   .. " nsit" ;local finalOk=trySayMessageRequest(finalCmd);if finalOk then return true;end return false;end local function resolvePlayerFromMessageObj(message) local uid;pcall(function() if (type(message)=="table") then uid=message.UserId or message.SenderUserId or message.FromUserId ;end end);if ((type(uid)=="number") and (uid>0)) then local p=Players:GetPlayerByUserId(uid);if p then return p;end end local speaker;pcall(function() if (type(message)=="table") then speaker=message.Speaker or message.SpeakerName or message.FromSpeaker or message.Sender ;end end);if ((type(speaker)=="string") and (speaker~="")) then local lowerS=string.lower(speaker);for _,pl in ipairs(Players:GetPlayers()) do if ((string.lower(pl.Name)==lowerS) or (string.lower(pl.DisplayName)==lowerS)) then return pl;end end return speaker;end pcall(function() if ((type(message)=="table") and message.TextSource and (typeof(message.TextSource)=="Instance")) then local tsid=message.TextSource.UserId;if ((type(tsid)=="number") and (tsid>0)) then local p2=Players:GetPlayerByUserId(tsid);if p2 then return p2;end end end end);return nil;end local function extractUserId(messageObj,resolved) local uid=nil;pcall(function() if (type(messageObj)=="table") then uid=messageObj.UserId or messageObj.SenderUserId or messageObj.FromUserId ;end end);if ( not uid and (type(messageObj)=="table") and messageObj.TextSource and (typeof(messageObj.TextSource)=="Instance")) then pcall(function() uid=messageObj.TextSource.UserId;end);end if ( not uid and resolved and (typeof(resolved)=="Instance") and resolved.UserId) then uid=resolved.UserId;end return uid;end local function onDetected(messageObj,text) if  not text then return;end if  not string.find(string.lower(tostring(text)),"hl",1,true) then return;end local resolved=resolvePlayerFromMessageObj(messageObj);local uid=extractUserId(messageObj,resolved);if (type(uid)~="number") then return;end if  not allowedUserIds[uid] then return;end local speakerKey=tostring(uid);local now=tick();local last=respondedCooldown[speakerKey];if (last and ((now-last)<2.5)) then return;end respondedCooldown[speakerKey]=now;local target=resolved;if (( not target or (typeof(target)~="Instance")) and (type(uid)=="number")) then local p=Players:GetPlayerByUserId(uid);if p then target=p;end end if  not target then target=tostring(uid);end sendNsitToTargetOnce(target);end pcall(function() if TextChatService then if (TextChatService.OnIncomingMessage~=nil) then pcall(function() TextChatService.OnIncomingMessage=function(message) local txt=((type(message)=="table") and message.Text) or nil ;onDetected(message,txt);return message;end;end);end if (TextChatService.MessageReceived and (typeof(TextChatService.MessageReceived.Connect)=="function")) then pcall(function() TextChatService.MessageReceived:Connect(function(channel,message) local txt=(message and message.Text) or nil ;onDetected(message,txt);end);end);end end end);pcall(function() local events=ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents");if events then local done=events:FindFirstChild("OnMessageDoneFiltering");if (done and done:IsA("RemoteEvent")) then pcall(function() done.OnClientEvent:Connect(function(data) local txt=((type(data)=="table") and (data.Message or data.message or data.Text or data.text)) or data ;onDetected(data,txt);end);end);end end end);pcall(function() for _,pl in ipairs(Players:GetPlayers()) do pcall(function() pl.Chatted:Connect(function(msg) onDetected({Speaker=pl.Name,UserId=pl.UserId},msg);end);end);end Players.PlayerAdded:Connect(function(pl) pcall(function() pl.Chatted:Connect(function(msg) onDetected({Speaker=pl.Name,UserId=pl.UserId},msg);end);end);end);end); end
